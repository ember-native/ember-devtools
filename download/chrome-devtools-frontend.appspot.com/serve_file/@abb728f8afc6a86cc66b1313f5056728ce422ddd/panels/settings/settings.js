import*as e from"../../core/common/common.js";import*as t from"../../core/host/host.js";import*as i from"../../core/i18n/i18n.js";import*as s from"../../core/root/root.js";import*as n from"../../ui/components/icon_button/icon_button.js";import*as o from"../../ui/legacy/components/utils/utils.js";import*as r from"../../ui/legacy/legacy.js";import*as a from"../../ui/visual_logging/visual_logging.js";import{PanelUtils as l}from"../utils/utils.js";import*as d from"./components/components.js";import*as c from"../../ui/components/buttons/buttons.js";import*as h from"../../ui/components/input/input.js";import*as g from"../../ui/components/legacy_wrapper/legacy_wrapper.js";import*as p from"../../ui/components/switch/switch.js";import*as u from"../../ui/lit-html/lit-html.js";import*as m from"../../core/platform/platform.js";const b=new CSSStyleSheet;b.replaceSync('.settings-window-main{color:var(--sys-color-on-surface);background-color:var(--sys-color-cdt-base-container)}.settings-content{overflow-y:auto;overflow-x:hidden;margin:8px 8px 8px 0;padding:0 4px;flex:auto}.settings-container{width:100%;column-width:288px}.settings-block{display:block;padding-bottom:9px;width:288px;break-inside:avoid}.settings-tab.settings-container{column-width:308px}.settings-tab .settings-block{margin-left:20px}.settings-line{padding-bottom:5px;margin-bottom:5px}.settings-key-cell{display:inline-block;width:153px;white-space:nowrap;text-align:right;vertical-align:middle;padding-right:6px}.settings-cell{display:inline-block;width:135px;vertical-align:middle}.settings-section-title{font-size:120%;text-align:left}.settings-combine-keys{margin:0 0.3em;font-size:9px}fieldset{margin:0;padding:0;border:none}.experiments-filter{padding-top:1px;display:flex;align-items:center}label{padding-right:8px;padding-bottom:8px}.experiments-filter label{padding-bottom:0}.settings-tab p{margin:6px 0}.settings-block p p{padding-left:30px}.settings-select{align-items:center;display:grid}.settings-experiments-warning-subsection-warning{color:var(--sys-color-error)}.settings-experiments-warning-subsection-message{color:inherit}.settings-content input[type="checkbox"]{margin:1px 7px 1px 2px}.settings-window-label-element{flex:none}.settings-window-title{display:flex;align-items:center;font-size:var(--sys-size-9);color:var(--sys-color-on-surface);margin:var(--sys-size-8) var(--sys-size-7);&::before{content:"";width:var(--sys-size-9);height:var(--sys-size-9);margin-right:var(--sys-size-6);background-image:var(--image-file-devtools)}}.settings-container-wrapper{position:absolute;top:31px;left:0;right:0;bottom:0;overflow:auto;padding-top:9px;border-top:1px solid var(--sys-color-divider)}.settings-tab.settings-content{margin:0;padding:0}.settings-tab-container{flex:auto;overflow:hidden}.settings-tab-container header{padding:0 0 6px}#experiments-tab-content .settings-container{column-width:auto}#experiments-tab-content .settings-block{width:auto;margin-left:0;margin-right:10px}.settings-tab-container header > h1{font-size:18px;font-weight:normal;margin:0;padding-bottom:3px;white-space:nowrap}.settings-tab .settings-section-title{margin-left:-20px;color:var(--sys-color-on-surface-subtle)}.settings-tab select{margin-left:10px;width:80%}.settings-experiment{display:grid;grid-template-columns:auto min-content auto 1fr}.settings-experiment .devtools-link{display:flex!important;align-items:center}.settings-experiment .devtools-link:has(.link-icon){outline-offset:0}.experiment-label{margin-right:2px}.settings-experiment-unstable{color:var(--sys-color-token-subtle)}.settings-experiment .feedback-link{color:var(--sys-color-primary);text-decoration-line:underline;margin-left:4px}.tabbed-pane-content slot::slotted(.widget){overflow:visible!important}@media (forced-colors: active){.settings-window-title{color:canvastext}.tabbed-pane-header-tab{background:ButtonFace}.tabbed-pane-header-tab-title{color:canvastext}}@media (forced-colors: active) and (prefers-color-scheme: dark){.tabbed-pane-header-tab.selected{background:ButtonFace}.tabbed-pane-header-tab.selected .tabbed-pane-header-tab-title{color:HighlightText}}\n/*# sourceURL=settingsScreen.css */\n');const y={settings:"Settings",shortcuts:"Shortcuts",preferences:"Preferences",restoreDefaultsAndReload:"Restore defaults and reload",experiments:"Experiments",theseExperimentsCouldBeUnstable:"These experiments could be unstable or unreliable and may require you to restart DevTools.",theseExperimentsAreParticularly:"These experiments are particularly unstable. Enable at your own risk.",warning:"WARNING:",oneOrMoreSettingsHaveChanged:"One or more settings have changed which requires a reload to take effect.",filterExperimentsLabel:"Filter",noResults:"No experiments match the filter",learnMore:"Learn more",sendFeedback:"Send feedback"},S=i.i18n.registerUIStrings("panels/settings/SettingsScreen.ts",y),v=i.i18n.getLocalizedString.bind(void 0,S);let f;class x extends r.Widget.VBox{tabbedLocation;keybindsTab;reportTabOnReveal;constructor(){super(!0),this.contentElement.classList.add("settings-window-main"),this.contentElement.classList.add("vbox");const e=document.createElement("div");e.classList.add("settings-window-label-element");const t=r.UIUtils.createShadowRootWithCoreStyles(e,{cssFile:[b],delegatesFocus:void 0}).createChild("div","settings-window-title");r.ARIAUtils.markAsHeading(t,1),t.textContent=v(y.settings),this.tabbedLocation=r.ViewManager.ViewManager.instance().createTabbedLocation((()=>x.revealSettingsScreen()),"settings-view");const i=this.tabbedLocation.tabbedPane();i.registerCSSFiles([b]),i.headerElement().prepend(e),i.setShrinkableTabs(!1),i.makeVerticalTabLayout();const s=r.ViewManager.ViewManager.instance().view("keybinds");s&&s.widget().then((e=>{this.keybindsTab=e})),i.show(this.contentElement),i.selectTab("preferences"),i.addEventListener(r.TabbedPane.Events.TabInvoked,this.tabInvoked,this),this.reportTabOnReveal=!1}static instance(e={forceNew:null}){const{forceNew:t}=e;return f&&!t||(f=new x),f}static revealSettingsScreen(){const e=x.instance();if(e.isShowing())return e;e.reportTabOnReveal=!0;const t=new r.Dialog.Dialog("settings");return t.contentElement.tabIndex=-1,t.addCloseButton(),t.setOutsideClickCallback((()=>{})),t.setPointerEventsBehavior("PierceGlassPane"),t.setOutsideTabIndexBehavior("PreserveMainViewTabIndex"),e.show(t.contentElement),t.setEscapeKeyCallback(e.onEscapeKeyPressed.bind(e)),t.setMarginBehavior("NoMargin"),t.show(),e}static async showSettingsScreen(e={name:void 0,focusTabHeader:void 0}){const{name:t,focusTabHeader:i}=e,s=x.revealSettingsScreen();s.selectTab(t||"preferences");const n=s.tabbedLocation.tabbedPane();await n.waitForTabElementUpdate(),i?n.focusSelectedTabHeader():n.focus()}resolveLocation(e){return this.tabbedLocation}selectTab(e){this.tabbedLocation.tabbedPane().selectTab(e,!0)}tabInvoked(e){const t=e.data;if(!t.isUserGesture)return;const i=t.prevTabId,s=t.tabId;!this.reportTabOnReveal&&i&&i===s||(this.reportTabOnReveal=!1,this.reportSettingsPanelShown(s))}reportSettingsPanelShown(e){e!==v(y.shortcuts)?t.userMetrics.settingsPanelShown(e):t.userMetrics.settingsPanelShown("shortcuts")}onEscapeKeyPressed(e){"keybinds"===this.tabbedLocation.tabbedPane().selectedTabId&&this.keybindsTab&&this.keybindsTab.onEscapeKeyPressed(e)}wasShown(){super.wasShown(),this.registerCSSFiles([b])}}class w extends r.Widget.VBox{containerElement;constructor(e,t){super(),this.element.classList.add("settings-tab-container"),t&&(this.element.id=t);const i=this.element.createChild("header");r.UIUtils.createTextChild(i.createChild("h1"),e),this.containerElement=this.element.createChild("div","settings-container-wrapper").createChild("div","settings-tab settings-content settings-container")}appendSection(e){const t=this.containerElement.createChild("div","settings-block");if(e){r.ARIAUtils.markAsGroup(t);const i=t.createChild("div","settings-section-title");i.textContent=e,r.ARIAUtils.markAsHeading(i,2),r.ARIAUtils.setLabel(t,e)}return t}}class k extends w{syncSection=new d.SyncSection.SyncSection;settingToControl=new Map;constructor(){super(v(y.preferences),"preferences-tab-content"),this.element.setAttribute("jslog",`${a.pane("preferences")}`);const t=["","APPEARANCE","SOURCES","ELEMENTS","NETWORK","PERFORMANCE","MEMORY","CONSOLE","EXTENSIONS","PERSISTENCE","DEBUGGER","GLOBAL","SYNC"],i=e.Settings.Settings.instance().getRegisteredSettings().sort(((e,t)=>e.order&&t.order?e.order-t.order:e.order?-1:t.order?1:0));for(const e of t){const t=i.filter((t=>t.category===e&&k.isSettingVisible(t)));this.createSectionElement(e,t)}const s=r.UIUtils.createTextButton(v(y.restoreDefaultsAndReload),(function(){e.Settings.Settings.instance().clearAll(),o.Reload.reload()}),{jslogContext:"settings.restore-defaults-and-reload"});this.appendSection().appendChild(s)}static isSettingVisible(e){return Boolean(e.title?.())&&Boolean(e.category)}wasShown(){r.Context.Context.instance().setFlavor(k,this),super.wasShown(),this.updateSyncSection()}willHide(){super.willHide(),r.Context.Context.instance().setFlavor(k,null)}updateSyncSection(){t.InspectorFrontendHost.InspectorFrontendHostInstance.getSyncInformation((t=>{this.syncSection.data={syncInfo:t,syncSetting:e.Settings.moduleSetting("sync-preferences")}}))}createExtensionSection(e){const t=o.Linkifier.LinkHandlerSettingUI.instance().settingElement();if(t){this.createStandardSectionElement("EXTENSIONS",e).appendChild(t)}}createSectionElement(e,t){"EXTENSIONS"===e?this.createExtensionSection(t):"SYNC"===e&&t.length>0?this.containerElement.appendChild(this.syncSection):t.length>0&&this.createStandardSectionElement(e,t)}createStandardSectionElement(t,i){const s=e.Settings.getLocalizedSettingsCategory(t),n=this.appendSection(s);for(const t of i){const i=e.Settings.Settings.instance().moduleSetting(t.settingName),s=r.SettingsUI.createControlForSetting(i);s&&(this.settingToControl.set(i,s),n.appendChild(s))}return n}highlightObject(t){if(t instanceof e.Settings.Setting){const e=this.settingToControl.get(t);e&&l.highlightElement(e)}}}class I extends w{#e;#t;#i;experimentToControl=new Map;constructor(){super(v(y.experiments),"experiments-tab-content");const e=this.appendSection();e.classList.add("experiments-filter"),this.element.setAttribute("jslog",`${a.pane("experiments")}`);const t=e.createChild("label");t.textContent=v(y.filterExperimentsLabel),this.#i=r.UIUtils.createInput("","text","experiments-filter"),r.ARIAUtils.bindLabelToControl(t,this.#i),e.appendChild(this.#i),this.#i.addEventListener("input",(()=>this.renderExperiments(this.#i.value.toLowerCase())),!1),this.setDefaultFocusedElement(this.#i),this.setFilter("")}renderExperiments(e){this.experimentToControl.clear(),this.#e&&this.#e.remove(),this.#t&&this.#t.remove();const t=s.Runtime.experiments.allConfigurableExperiments().sort(),i=t.filter((t=>t.unstable&&t.title.toLowerCase().includes(e))),n=t.filter((t=>!t.unstable&&t.title.toLowerCase().includes(e)));if(n.length){this.#e=this.appendSection();const e=v(y.theseExperimentsCouldBeUnstable);this.#e.appendChild(this.createExperimentsWarningSubsection(e));for(const e of n)this.#e.appendChild(this.createExperimentCheckbox(e))}if(i.length){this.#t=this.appendSection();const e=v(y.theseExperimentsAreParticularly);this.#t.appendChild(this.createExperimentsWarningSubsection(e));for(const e of i)this.#t.appendChild(this.createExperimentCheckbox(e))}if(!n.length&&!i.length){this.#e=this.appendSection();const e=this.#e.createChild("span");e.textContent=v(y.noResults),r.ARIAUtils.alert(e.textContent)}}createExperimentsWarningSubsection(e){const t=document.createElement("div");t.createChild("span","settings-experiments-warning-subsection-warning").textContent=v(y.warning),r.UIUtils.createTextChild(t," ");return t.createChild("span","settings-experiments-warning-subsection-message").textContent=e,t}createExperimentCheckbox(e){const i=r.UIUtils.CheckboxLabel.create(e.title,e.isEnabled(),void 0,e.name);i.classList.add("experiment-label");const s=i.checkboxElement;s.name=e.name,s.addEventListener("click",(function(){e.setEnabled(s.checked),t.userMetrics.experimentChanged(e.name,e.isEnabled()),r.InspectorView.InspectorView.instance().displayReloadRequiredWarning(v(y.oneOrMoreSettingsHaveChanged))}),!1);const o=document.createElement("p");if(this.experimentToControl.set(e,o),o.classList.add("settings-experiment"),e.unstable&&!e.isEnabled()&&o.classList.add("settings-experiment-unstable"),o.appendChild(i),e.docLink){const t=r.XLink.XLink.create(e.docLink,void 0,void 0,void 0,`${e.name}-documentation`);t.textContent="",t.setAttribute("aria-label",v(y.learnMore));const i=new n.Icon.Icon;i.data={iconName:"help",color:"var(--icon-default)",width:"16px",height:"16px"},i.classList.add("link-icon"),t.prepend(i),o.appendChild(t)}if(e.feedbackLink){const t=r.XLink.XLink.create(e.feedbackLink,void 0,void 0,void 0,`${e.name}-feedback`);t.textContent=v(y.sendFeedback),t.classList.add("feedback-link"),o.appendChild(t)}return o}highlightObject(e){if(e instanceof s.Runtime.Experiment){const t=this.experimentToControl.get(e);t&&l.highlightElement(t)}}setFilter(e){this.#i.value=e,this.#i.dispatchEvent(new Event("input",{bubbles:!0,cancelable:!0}))}wasShown(){r.Context.Context.instance().setFlavor(I,this),super.wasShown()}willHide(){super.willHide(),r.Context.Context.instance().setFlavor(I,null)}}var C=Object.freeze({__proto__:null,SettingsScreen:x,GenericSettingsTab:k,ExperimentsSettingsTab:I,ActionDelegate:class{handleAction(e,i){switch(i){case"settings.show":return x.showSettingsScreen({focusTabHeader:!0}),!0;case"settings.documentation":return t.InspectorFrontendHost.InspectorFrontendHostInstance.openInNewTab(r.UIUtils.addReferrerToURL("https://developer.chrome.com/docs/devtools/")),!0;case"settings.shortcuts":return x.showSettingsScreen({name:"keybinds",focusTabHeader:!0}),!0}return!1}},Revealer:class{async reveal(i){const n=r.Context.Context.instance();if(i instanceof s.Runtime.Experiment){t.InspectorFrontendHost.InspectorFrontendHostInstance.bringToFront(),await x.showSettingsScreen({name:"experiments"});const e=n.flavor(I);null!==e&&e.highlightObject(i)}else{for(const s of e.Settings.Settings.instance().getRegisteredSettings())if(k.isSettingVisible(s)&&s.settingName===i.name){t.InspectorFrontendHost.InspectorFrontendHostInstance.bringToFront(),await x.showSettingsScreen();const e=n.flavor(k);return void(null!==e&&e.highlightObject(i))}for(const s of r.ViewManager.getRegisteredViewExtensions(e.Settings.Settings.instance().getHostConfig())){const e=s.viewId();if("settings-view"!==s.location())continue;const n=s.settings();if(n&&-1!==n.indexOf(i.name)){t.InspectorFrontendHost.InspectorFrontendHostInstance.bringToFront(),await x.showSettingsScreen({name:e});const n=await s.widget();return void(n instanceof w&&n.highlightObject(i))}}}}}});const E=new CSSStyleSheet;E.replaceSync(':host{overflow:hidden}.header{padding:0 0 6px;border-bottom:1px solid var(--sys-color-divider);font-size:18px;font-weight:normal;flex:none}.intro{margin-top:10px}.ignore-list-option{flex:none;padding:3px 6px;min-height:30px}.ignore-list-option devtools-icon{margin-bottom:-1px}.ignore-list-option-group{margin-top:13px;margin-bottom:3px;margin-left:8px;flex-shrink:0}.add-button{margin:10px 2px;align-self:flex-start;flex:none}.ignore-list{max-width:500px;flex:0 1 auto}.ignore-list-global-enable{padding:3px 0;color:var(--sys-color-token-subtle);font-size:120%;margin-top:17px}.ignore-list-item{padding:3px 5px;height:30px;display:flex;align-items:center;position:relative;flex:auto 1 1}.ignore-list-pattern{flex:auto;min-width:100px}.ignore-list-item > [is="dt-checkbox"]{width:100%}.ignore-list-item .ignore-list-pattern{white-space:nowrap;text-overflow:ellipsis;user-select:none;color:var(--sys-color-on-surface);overflow:hidden}.ignore-list-edit-row{flex:none;display:flex;flex-direction:row;margin:6px 5px;align-items:center}.ignore-list-edit-row input,\n.ignore-list-edit-row select{width:100%;text-align:inherit}.ignore-list-options{margin-left:22px;display:flex;flex-direction:column}.ignore-list-options.ignore-listing-disabled{opacity:30%}.list:has(.ignore-list-empty),\n.list:has(.ignore-list-edit-row),\n.list:has(.ignore-list-item){border:none}.editor-container:has(.ignore-list-edit-row){background:var(--sys-color-surface1);border-radius:10px}.ignore-list.list-editing ~ .add-button{display:none}.devtools-link:has(devtools-icon){margin-left:6px}\n/*# sourceURL=frameworkIgnoreListSettingsTab.css */\n');const A={frameworkIgnoreList:"Framework Ignore List",debuggerWillSkipThroughThe:"Debugger will skip through the scripts and will not stop on exceptions thrown by them.",ignoreListContentScripts:"Content scripts injected by extensions",automaticallyIgnoreListKnownThirdPartyScripts:"Known third-party scripts from source maps",enableIgnoreListing:"Enable Ignore Listing",enableIgnoreListingTooltip:"Uncheck to disable all ignore listing",generalExclusionRules:"General exclusion rules:",customExclusionRules:"Custom exclusion rules:",addPattern:"Add pattern...",addFilenamePattern:"Add filename pattern",ignoreScriptsWhoseNamesMatchS:"Ignore scripts whose names match ''{PH1}''",pattern:"Add Pattern",patternCannotBeEmpty:"Pattern cannot be empty",patternAlreadyExists:"Pattern already exists",patternMustBeAValidRegular:"Pattern must be a valid regular expression",learnMore:"Learn more"},L=i.i18n.registerUIStrings("panels/settings/FrameworkIgnoreListSettingsTab.ts",A),T=i.i18n.getLocalizedString.bind(void 0,L);class R extends r.Widget.VBox{list;setting;editor;constructor(){super(!0),this.element.setAttribute("jslog",`${a.pane("blackbox")}`);const t=this.contentElement.createChild("div","header");t.textContent=T(A.frameworkIgnoreList),r.ARIAUtils.markAsHeading(t,1),this.contentElement.createChild("div","intro").textContent=T(A.debuggerWillSkipThroughThe);const i=e.Settings.Settings.instance().moduleSetting("enable-ignore-listing"),s=this.contentElement.createChild("div","ignore-list-global-enable");s.appendChild(r.SettingsUI.createSettingCheckbox(T(A.enableIgnoreListing),i,!0)),r.Tooltip.Tooltip.install(s,T(A.enableIgnoreListingTooltip));const o=this.contentElement.createChild("div","ignore-list-options"),l=this.createSettingGroup(T(A.generalExclusionRules));o.appendChild(l);l.createChild("div","ignore-list-option").appendChild(r.SettingsUI.createSettingCheckbox(T(A.ignoreListContentScripts),e.Settings.Settings.instance().moduleSetting("skip-content-scripts"),!0));const d=l.createChild("div","ignore-list-option");d.appendChild(r.SettingsUI.createSettingCheckbox(T(A.automaticallyIgnoreListKnownThirdPartyScripts),e.Settings.Settings.instance().moduleSetting("automatically-ignore-list-known-third-party-scripts"),!0));const c=r.XLink.XLink.create("http://goo.gle/skip-third-party",void 0,void 0,void 0,"learn-more");c.textContent="",c.setAttribute("aria-label",T(A.learnMore));const h=new n.Icon.Icon;h.data={iconName:"help",color:"var(--icon-default)",width:"16px",height:"16px"},c.prepend(h),d.appendChild(c);const g=this.createSettingGroup(T(A.customExclusionRules));o.appendChild(g),this.list=new r.ListWidget.ListWidget(this),this.list.element.classList.add("ignore-list");const p=document.createElement("div");p.classList.add("ignore-list-empty"),this.list.setEmptyPlaceholder(p),this.list.show(g);const u=r.UIUtils.createTextButton(T(A.addPattern),this.addButtonClicked.bind(this),{className:"add-button",jslogContext:"settings.add-ignore-list-pattern"});function m(){i.get()?o.classList.remove("ignore-listing-disabled"):o.classList.add("ignore-listing-disabled")}r.ARIAUtils.setLabel(u,T(A.addFilenamePattern)),g.appendChild(u),this.setting=e.Settings.Settings.instance().moduleSetting("skip-stack-frames-pattern"),this.setting.addChangeListener(this.settingUpdated,this),this.setDefaultFocusedElement(u),i.addChangeListener(m),m()}wasShown(){super.wasShown(),this.list.registerCSSFiles([E]),this.registerCSSFiles([E]),this.settingUpdated()}settingUpdated(){this.list.clear();const e=this.setting.getAsArray();for(let t=0;t<e.length;++t)this.list.appendItem(e[t],!0)}addButtonClicked(){this.list.addNewItem(this.setting.getAsArray().length,{pattern:"",disabled:!1})}createSettingGroup(e){const t=document.createElement("div");t.classList.add("ignore-list-option-group"),r.ARIAUtils.markAsGroup(t);const i=t.createChild("div","ignore-list-option-group-title");return r.ARIAUtils.markAsHeading(i,2),r.ARIAUtils.setLabel(t,e),i.textContent=e,t}renderItem(e,t){const i=document.createElement("div"),s=this.setting,n=r.UIUtils.CheckboxLabel.create(e.pattern,!e.disabled,void 0,"settings.ignore-list-pattern"),o=T(A.ignoreScriptsWhoseNamesMatchS,{PH1:e.pattern});return r.Tooltip.Tooltip.install(n,o),n.checkboxElement.ariaLabel=o,n.checkboxElement.addEventListener("change",(function(){const t=!n.checkboxElement.checked;e.disabled!==t&&(e.disabled=t,e.disabledForUrl=void 0,s.setAsArray(s.getAsArray()))}),!1),i.appendChild(n),i.classList.add("ignore-list-item"),i}removeItemRequested(e,t){const i=this.setting.getAsArray();i.splice(t,1),this.setting.setAsArray(i)}commitEdit(e,t,i){e.pattern=t.control("pattern").value.trim();const s=this.setting.getAsArray();i&&s.push(e),this.setting.setAsArray(s)}beginEdit(e){const t=this.createEditor();return t.control("pattern").value=e.pattern,t}createEditor(){if(this.editor)return this.editor;const e=new r.ListWidget.Editor;this.editor=e;const t=e.contentElement();t.createChild("div","ignore-list-edit-row").createChild("div","ignore-list-pattern").textContent=T(A.pattern);const i=t.createChild("div","ignore-list-edit-row"),s=e.createInput("pattern","text","/framework\\.js$",function(e,t,i){const s=i.value.trim(),n=this.setting.getAsArray();if(!s.length)return{valid:!1,errorMessage:T(A.patternCannotBeEmpty)};for(let e=0;e<n.length;++e)if(e!==t&&n[e].pattern===s)return{valid:!1,errorMessage:T(A.patternAlreadyExists)};let o;try{o=new RegExp(s)}catch(e){}if(!o)return{valid:!1,errorMessage:T(A.patternMustBeAValidRegular)};return{valid:!0,errorMessage:void 0}}.bind(this));return r.ARIAUtils.setLabel(s,T(A.pattern)),i.createChild("div","ignore-list-pattern").appendChild(s),e}}var U=Object.freeze({__proto__:null,FrameworkIgnoreListSettingsTab:R});const F=new CSSStyleSheet;F.replaceSync("*{box-sizing:border-box}.shared-disclaimer{background:linear-gradient(135deg,var(--sys-color-gradient-primary),var(--sys-color-gradient-tertiary));border-radius:var(--sys-size-5);padding:var(--sys-size-9) var(--sys-size-11);max-width:var(--sys-size-35);min-width:var(--sys-size-28);h2{font:var(--sys-typescale-headline5);margin:0 0 var(--sys-size-6)}}.disclaimer-list-header{font:var(--sys-typescale-body5-medium)}.disclaimer-list{padding:var(--sys-size-6) 0 0;display:grid;grid-template-columns:var(--sys-size-12) auto;gap:var(--sys-size-6) 0;line-height:var(--sys-typescale-body5-line-height)}.settings-container{display:grid;grid-template-columns:1fr auto auto;border-radius:var(--sys-size-5);box-shadow:var(--sys-elevation-level3);margin:var(--sys-size-11) 0 var(--sys-size-4);line-height:var(--sys-typescale-body5-line-height);min-width:var(--sys-size-28);max-width:var(--sys-size-35)}.accordion-header{display:grid;grid-template-columns:auto 1fr auto;&:hover{background-color:var(--sys-color-state-hover-on-subtle)}}.icon-container,\n.dropdown{padding:0 var(--sys-size-8)}.toggle-container{padding:0 var(--sys-size-8) 0 var(--sys-size-9);&:hover{background-color:var(--sys-color-state-hover-on-subtle)}}.expansion-grid{padding:var(--sys-size-4) var(--sys-size-8) var(--sys-size-6);display:grid;grid-template-columns:var(--sys-size-9) auto;gap:var(--sys-size-6) var(--sys-size-8);line-height:var(--sys-typescale-body5-line-height);color:var(--sys-color-on-surface-subtle)}.expansion-grid-whole-row{grid-column:span 2;font-weight:var(--ref-typeface-weight-medium);color:var(--sys-color-on-surface);padding-top:var(--sys-size-4)}.setting-description{color:var(--sys-color-on-surface-subtle)}.centered{display:grid;place-content:center}.setting-card{padding:var(--sys-size-6) 0}.divider{margin:var(--sys-size-5) 0;border-left:var(--sys-size-1) solid var(--sys-color-divider)}.accordion-header ~ .accordion-header,\n.divider ~ .divider,\n.toggle-container ~ .toggle-container{border-top:var(--sys-size-1) solid var(--sys-color-divider)}.whole-row{grid-column:span 5;overflow:hidden;display:grid;grid-template-rows:0fr;transition:grid-template-rows var(--sys-motion-duration-short4) ease-in}.whole-row.open{grid-template-rows:1fr}.overflow-hidden{overflow:hidden}.link,\n.devtools-link{color:var(--sys-color-primary);text-decoration:underline;cursor:pointer;outline-offset:var(--sys-size-2);padding:0;font-weight:var(--ref-typeface-weight-regular)}.padded{padding:var(--sys-size-2) 0}.settings-container-wrapper{position:absolute;top:31px;left:0;right:0;bottom:0;overflow:auto;padding:var(--sys-size-6);border-top:1px solid var(--sys-color-divider);display:flex;flex-direction:column;align-items:center}header{font-size:var(--sys-typescale-headline3-size);font-weight:var(--ref-typeface-weight-regular)}\n/*# sourceURL=aiSettingsTab.css */\n");const $={boostYourProductivity:"Boost your productivity with Chrome AI",thingsToConsider:"Things to consider",experimentalFeatures:"These features are experimental and may change",maybeInaccurate:"These features use generative AI and may provide inaccurate or offensive information that do not represent Google’s views",sendsDataToGoogle:"Using these features sends data relevant for the feature to Google. Please find more feature-specific information below.",collectData:"Google collects this data and feedback to improve its products and services with the help of human reviewers. Avoid sharing sensitive or personal information.",retainData:"Usage data will be stored in a way where Google cannot tell who provided it and can no longer fulfill any deletion requests and will be retained for up to 18 months",managedAccount:"Google may refrain from data collection depending on your Google account management and/or region",adminSettings:"Features available to managed users may vary depending upon their administrator’s settings",helpUnderstandConsole:"Helps you understand and fix console warnings and errors",collapse:"collapse",expand:"expand",whenOn:"When on",explainConsole:"Get explanations for console warnings and errors",receiveSuggestions:"Receive suggestions and code samples to address these issues",consoleInsightsSendsData:"The console message, associated stack trace, related source code, and the associated network headers are sent to Google to generate explanations. This data may be seen by human reviewers to improve this feature.",termsOfServicePrivacyNotice:"Use of this feature is subject to the {PH1} and {PH2}",generatedSnippets:"Use generated code snippets with caution",helpUnderstandStyling:"Helps you understand and fix styling issues",learnMore:"Learn more",explainStyling:"Get explanations and additional context for styling behaviors",receiveStylingSuggestions:"Receive suggestions and code samples for fixing styling issues",freestylerSendsData:"Any DOM or CSS content on the inspected page may be sent to Google to generate explanations. This data may be seen by human reviewers to improve this feature.",termsOfService:"Google Terms of Service",privacyNotice:"Privacy Notice",oneOrMoreSettingsHaveChanged:"One or more settings have changed which requires a reload to take effect.",chromeAi:"Chrome AI"},M=i.i18n.registerUIStrings("panels/settings/AISettingsTab.ts",$),z=i.i18n.getLocalizedString.bind(void 0,M),P=new URL("../../Images/chevron-down.svg",import.meta.url).toString(),N=new URL("../../Images/chevron-up.svg",import.meta.url).toString();class K extends g.LegacyWrapper.WrappableComponent{static litTagName=u.literal`devtools-settings-ai-settings-tab`;#s=this.attachShadow({mode:"open"});#n;#o;#r=!1;#a=!1;constructor(){super();try{this.#n=e.Settings.Settings.instance().moduleSetting("console-insights-enabled")}catch{this.#n=void 0}try{this.#o=e.Settings.Settings.instance().moduleSetting("freestyler-enabled")}catch{this.#o=void 0}}connectedCallback(){this.#s.adoptedStyleSheets=[h.checkboxStyles,F]}#l(){this.#r=!this.#r,this.render()}#d(e){if(e.target instanceof p.Switch.Switch&&e.type!==p.Switch.SwitchChangeEvent.eventName)return;if(!this.#n)return;const t=this.#n.get();this.#n.set(!t),t||this.#r||(this.#r=!0),r.InspectorView.InspectorView.instance().displayReloadRequiredWarning(z($.oneOrMoreSettingsHaveChanged)),this.render()}#c(){this.#a=!this.#a,this.render()}#h(e){if(e.target instanceof p.Switch.Switch&&e.type!==p.Switch.SwitchChangeEvent.eventName)return;if(!this.#o)return;const t=this.#o.get();this.#o.set(!t),t||this.#a||(this.#a=!0),r.InspectorView.InspectorView.instance().displayReloadRequiredWarning(z($.oneOrMoreSettingsHaveChanged)),this.render()}#g(e,t){return u.html`
      <div>
        <${n.Icon.Icon.litTagName} .data=${{iconName:e,color:"var(--icon-default)",width:"var(--sys-size-8)",height:"var(--sys-size-8)"}}>
        </${n.Icon.Icon.litTagName}>
      </div>
      <div>${t}</div>
    `}#p(){const e=[{icon:"psychiatry",text:z($.experimentalFeatures)},{icon:"report",text:z($.maybeInaccurate)},{icon:"google",text:z($.sendsDataToGoogle)},{icon:"account-box",text:z($.collectData)},{icon:"calendar-today",text:z($.retainData)},{icon:"globe",text:z($.managedAccount)},{icon:"corporate-fare",text:z($.adminSettings)}];return u.html`
      <div class="shared-disclaimer">
        <h2>${z($.boostYourProductivity)}</h2>
        <span class="disclaimer-list-header">${z($.thingsToConsider)}</span>
        <div class="disclaimer-list">
          ${e.map((e=>this.#g(e.icon,e.text)))}
        </div>
      </div>
    `}#u(e,t){return u.html`
      <div>
        <${n.Icon.Icon.litTagName} .data=${{iconName:e,width:"var(--sys-size-9)",height:"var(--sys-size-9)"}}>
        </${n.Icon.Icon.litTagName}>
      </div>
      <div class="padded">${t}</div>
    `}#m(){const e={"whole-row":!0,open:this.#r},t=this.#r?"0":"-1",s=r.XLink.XLink.create("http://policies.google.com/terms",z($.termsOfService),void 0,void 0,"terms-of-service",t),o=r.XLink.XLink.create("http://policies.google.com/privacy",z($.privacyNotice),void 0,void 0,"privacy-notice",t);return u.html`
      <div class="accordion-header" @click=${this.#l}>
        <div class="icon-container centered">
          <${n.Icon.Icon.litTagName} name="lightbulb-spark"></${n.Icon.Icon.litTagName}>
        </div>
        <div class="setting-card">
          <div>${i.i18n.lockedString("Console Insights")}</div>
          <div class="setting-description">${z($.helpUnderstandConsole)}</div>
        </div>
        <div class="dropdown centered">
          <${c.Button.Button.litTagName}
            .data=${{title:this.#r?z($.collapse):z($.expand),size:"SMALL",iconUrl:this.#r?N:P,variant:"icon",jslogContext:"console-insights.accordion"}}
          ></${c.Button.Button.litTagName}>
        </div>
      </div>
      <div class="divider"></div>
      <div class="toggle-container centered" @click=${this.#d.bind(this)}>
        <${p.Switch.Switch.litTagName}
          .checked=${this.#n?.get()}
          .jslogContext=${this.#n?.name}
          @switchchange=${this.#d.bind(this)}
        ></${p.Switch.Switch.litTagName}>
      </div>
      <div class=${u.Directives.classMap(e)}>
        <div class="overflow-hidden">
          <div class="expansion-grid">
            <div class="expansion-grid-whole-row">${z($.whenOn)}</div>
            ${this.#u("lightbulb",z($.explainConsole))}
            ${this.#u("code",z($.receiveSuggestions))}
            <div class="expansion-grid-whole-row">${z($.thingsToConsider)}</div>
            ${this.#u("google",z($.consoleInsightsSendsData))}
            ${this.#u("policy",u.html`
              ${i.i18n.getFormatLocalizedString(M,$.termsOfServicePrivacyNotice,{PH1:s,PH2:o})}
            `)}
            ${this.#u("warning",u.html`
              <x-link
                href="http://support.google.com/legal/answer/13505487"
                class="link"
                tabindex=${t}
                jslog=${a.link("code-snippets-explainer.console-insights").track({click:!0})}
              >${z($.generatedSnippets)}</x-link>
            `)}
            <div class="expansion-grid-whole-row">
              <x-link
                href="http://goo.gle/devtools-console-messages-ai"
                class="link"
                tabindex=${t}
                jslog=${a.link("learn-more.console-insights").track({click:!0})}
              >${z($.learnMore)}</x-link>
            </div>
          </div>
        </div>
      </div>
    `}#b(){const e={"whole-row":!0,open:this.#a},t=this.#a?"0":"-1",s=r.XLink.XLink.create("http://policies.google.com/terms",z($.termsOfService),void 0,void 0,"terms-of-service",t),o=r.XLink.XLink.create("http://policies.google.com/privacy",z($.privacyNotice),void 0,void 0,"privacy-notice",t);return u.html`
      <div class="accordion-header" @click=${this.#c}>
        <div class="icon-container centered">
          <${n.Icon.Icon.litTagName} name="pen-spark"></${n.Icon.Icon.litTagName}>
        </div>
        <div class="setting-card">
          <div>${i.i18n.lockedString("Freestyler")}</div>
          <div class="setting-description">${z($.helpUnderstandStyling)}</div>
        </div>
        <div class="dropdown centered">
          <${c.Button.Button.litTagName}
            .data=${{title:this.#a?z($.collapse):z($.expand),size:"SMALL",iconUrl:this.#a?N:P,variant:"icon",jslogContext:"freestyler.accordion"}}
          ></${c.Button.Button.litTagName}>
        </div>
      </div>
      <div class="divider"></div>
      <div class="toggle-container centered" @click=${this.#h.bind(this)}>
        <${p.Switch.Switch.litTagName}
          .checked=${this.#o?.get()}
          .jslogContext=${this.#o?.name}
          @switchchange=${this.#h.bind(this)}
        ></${p.Switch.Switch.litTagName}>
      </div>
      <div class=${u.Directives.classMap(e)}>
        <div class="overflow-hidden">
          <div class="expansion-grid">
            <div class="expansion-grid-whole-row">${z($.whenOn)}</div>
            ${this.#u("lightbulb",z($.explainStyling))}
            ${this.#u("code",z($.receiveStylingSuggestions))}
            <div class="expansion-grid-whole-row">${z($.thingsToConsider)}</div>
            ${this.#u("google",z($.freestylerSendsData))}
            ${this.#u("policy",u.html`
              ${i.i18n.getFormatLocalizedString(M,$.termsOfServicePrivacyNotice,{PH1:s,PH2:o})}
            `)}
            ${this.#u("warning",u.html`
              <x-link
                href="http://support.google.com/legal/answer/13505487"
                class="link"
                tabindex=${t}
                jslog=${a.link("code-snippets-explainer.freestyler").track({click:!0})}
              >${z($.generatedSnippets)}</x-link>
            `)}
          </div>
        </div>
      </div>
    `}async render(){u.render(u.html`
      <header>${z($.chromeAi)}</header>
      <div class="settings-container-wrapper" jslog=${a.pane("chrome-ai")}>
        ${this.#p()}
        ${this.#n||this.#o?u.html`
          <div class="settings-container">
            ${this.#n?this.#m():u.nothing}
            ${this.#o?this.#b():u.nothing}
          </div>
        `:u.nothing}
      </div>
    `,this.#s,{host:this})}}customElements.define("devtools-settings-ai-settings-tab",K);var B=Object.freeze({__proto__:null,AISettingsTab:K});const D=new CSSStyleSheet;D.replaceSync('header{padding:0 0 6px;border-bottom:1px solid var(--sys-color-divider);flex:none;margin-bottom:16px}h1{font-size:18px;font-weight:normal;padding-bottom:3px;margin:0}[role="list"]{overflow:auto;> *{min-width:300px}}.keybinds-key{padding:0.1em 0.6em;border:1px solid var(--sys-color-neutral-outline);font-size:11px;background-color:var(--sys-color-neutral-container);color:var(--sys-color-on-surface);box-shadow:var(--box-shadow-outline-color);border-radius:3px;display:inline-block;margin:0 0.1em;text-shadow:0 1px 0 var(--sys-color-cdt-base-container);line-height:1.5;white-space:nowrap}.keybinds-list-item{min-height:30px;display:grid;grid-template-rows:repeat(auto-fit,minmax(30px,auto));grid-template-columns:1fr 30px 2fr 30px 30px;flex:auto 1 1}.keybinds-list-item:focus-visible{background-color:var(--sys-color-tonal-container)}.keybinds-list-item:not(.keybinds-category-header){padding:4px 0 4px 20px;border-radius:7px}.keybinds-list-item:not(.keybinds-category-header):last-child{margin-bottom:5px}.keybinds-list-item.keybinds-editing{background-color:var(--sys-color-neutral-container)}.keybinds-list-text.keybinds-action-name{padding-top:7px;grid-row:1/3}.keybinds-shortcut,\n.keybinds-info{grid-row:auto;grid-column:3/span 1}.keybinds-shortcut.devtools-link{align-items:center;margin-left:3px}.keybinds-shortcut .devtools-link{padding:4px 0}.keybinds-info .devtools-link{padding-top:6px}.keybinds-error{color:var(--sys-color-error)}.keybinds-list-item.keybinds-editing .keybinds-shortcut{display:flex}.keybinds-modified{grid-column:2/span 1;margin-top:2px}.keybinds-list-item button{border:none;padding:0;background:transparent}.keybinds-list-item button:hover devtools-icon{color:var(--icon-default-hover)}.keybinds-list-item button:focus-visible{background-color:var(--sys-color-tonal-container)}.keybinds-list-item button[disabled]{opacity:40%}.keybinds-cancel-button{grid-column:-1/span 1}.keybinds-edit-button{display:none;grid-row:1/span 1;grid-column:4/span 1}.keybinds-list-item:not(.keybinds-editing):hover .keybinds-edit-button,\n.keybinds-list-item:not(.keybinds-editing):focus-within .keybinds-edit-button{display:inline-block}.keybinds-list-text{padding:3px 0;user-select:none;color:var(--sys-color-on-surface);text-align:start;position:relative;margin-right:0}.keybinds-category-header{font-weight:bold;line-height:30px;white-space:nowrap}.keybinds-category-header:not(:nth-child(2)){border-top:1px solid var(--sys-color-divider)}.keybinds-list-item:not(.keybinds-category-header):hover,\n.keybinds-list-item:not(.keybinds-editing):focus-within{background:var(--sys-color-state-hover-on-subtle)}.keybinds-set-select{text-align:right;margin-bottom:16px}.keybinds-set-select label p{display:inline;color:var(--sys-color-on-surface)}.keybinds-set-select select{margin-left:6px;margin-top:6px}button.text-button{width:fit-content;align-self:flex-end}.keybinds-list-text input{margin:0 2px}.keybinds-list-text:has(.keybinds-delete-button){grid-column:3/-1}.docs-link.devtools-link{align-self:flex-start;min-height:2em;line-height:2em;margin-bottom:4px}.keybinds-footer{display:flex;flex-wrap:wrap;justify-content:space-between;min-height:fit-content;margin-top:10px}\n/*# sourceURL=keybindsSettingsTab.css */\n');const O={shortcuts:"Shortcuts",matchShortcutsFromPreset:"Match shortcuts from preset",keyboardShortcutsList:"Keyboard shortcuts list",shortcutModified:"Shortcut modified",noShortcutForAction:"No shortcut for action",addAShortcut:"Add a shortcut",confirmChanges:"Confirm changes",discardChanges:"Discard changes",removeShortcut:"Remove shortcut",editShortcut:"Edit shortcut",shortcutsCannotContainOnly:"Shortcuts cannot contain only modifier keys.",thisShortcutIsInUseByS:"This shortcut is in use by {PH1}: {PH2}.",RestoreDefaultShortcuts:"Restore default shortcuts",FullListOfDevtoolsKeyboard:"Full list of DevTools keyboard shortcuts and gestures",ResetShortcutsForAction:"Reset shortcuts for action",shortcutRemoved:"{PH1} Shortcut removed",shortcutChangesRestored:"Changes to shortcut restored to default",shortcutChangesApplied:"Changes to shortcut applied",shortcutChangesDiscared:"Changes to shortcut discarded"},H=i.i18n.registerUIStrings("panels/settings/KeybindsSettingsTab.ts",O),j=i.i18n.getLocalizedString.bind(void 0,H);class G extends r.Widget.VBox{items;list;editingItem;editingRow;constructor(){super(!0),this.element.setAttribute("jslog",`${a.pane("keybinds")}`);this.contentElement.createChild("header").createChild("h1").textContent=j(O.shortcuts);const t=e.Settings.Settings.instance().moduleSetting("active-keybind-set"),i=e.Settings.Settings.instance().moduleSetting("user-shortcuts");t.addChangeListener(this.update,this);const s=r.SettingsUI.createControlForSetting(t,j(O.matchShortcutsFromPreset));s&&(s.classList.add("keybinds-set-select"),this.contentElement.appendChild(s)),this.items=new r.ListModel.ListModel,this.list=new r.ListControl.ListControl(this.items,this,r.ListControl.ListMode.NonViewport),this.items.replaceAll(this.createListItems()),r.ARIAUtils.markAsList(this.list.element),this.contentElement.appendChild(this.list.element),r.ARIAUtils.setLabel(this.list.element,j(O.keyboardShortcutsList));const n=this.contentElement.createChild("div");n.classList.add("keybinds-footer");const o=r.XLink.XLink.create("https://developer.chrome.com/docs/devtools/shortcuts/",j(O.FullListOfDevtoolsKeyboard),void 0,void 0,"learn-more");o.classList.add("docs-link"),n.appendChild(o);const l=r.UIUtils.createTextButton(j(O.RestoreDefaultShortcuts),(()=>{i.set([]),t.set(r.ShortcutRegistry.DefaultShortcutSetting)}),{jslogContext:"restore-default-shortcuts"});n.appendChild(l),this.editingItem=null,this.editingRow=null,this.update()}createElementForItem(e){let t=document.createElement("div");if("string"==typeof e)r.ARIAUtils.setLevel(t,1),t.classList.add("keybinds-category-header"),t.textContent=r.ActionRegistration.getLocalizedActionCategory(e);else{const i=new W(e,this,e===this.editingItem);t=i.element,r.ARIAUtils.setLevel(t,2),e===this.editingItem&&(this.editingRow=i)}return t.classList.add("keybinds-list-item"),r.ARIAUtils.markAsListitem(t),t.tabIndex=e===this.list.selectedItem()&&e!==this.editingItem?0:-1,t}commitChanges(e,i){for(const[e,s]of i)"UnsetShortcut"!==e.type&&(r.ShortcutRegistry.ShortcutRegistry.instance().removeShortcut(e),s||t.userMetrics.actionTaken(t.UserMetrics.Action.ShortcutRemoved)),s&&(r.ShortcutRegistry.ShortcutRegistry.instance().registerUserShortcut(e.changeKeys(s).changeType("UserShortcut")),"UnsetShortcut"===e.type?t.userMetrics.actionTaken(t.UserMetrics.Action.UserShortcutAdded):t.userMetrics.actionTaken(t.UserMetrics.Action.ShortcutModified));this.stopEditing(e)}heightForItem(e){return 0}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,s){i&&(i.tabIndex=-1),s&&(t===this.editingItem&&this.editingRow?this.editingRow.focus():(s.tabIndex=0,this.list.element.hasFocus()&&s.focus()),this.setDefaultFocusedElement(s))}updateSelectedItemARIA(e,t){return!0}startEditing(e){this.list.selectItem(e),this.editingItem&&this.stopEditing(this.editingItem),r.UIUtils.markBeingEdited(this.list.element,!0),this.editingItem=e,this.list.refreshItem(e)}stopEditing(e){r.UIUtils.markBeingEdited(this.list.element,!1),this.editingItem=null,this.editingRow=null,this.list.refreshItem(e),this.focus()}createListItems(){const e=r.ActionRegistry.ActionRegistry.instance().actions().sort(((e,t)=>e.category()<t.category()?-1:e.category()>t.category()?1:e.id()<t.id()?-1:e.id()>t.id()?1:0)),t=[];let i;return e.forEach((e=>{"elements.toggle-element-search"!==e.id()&&(i!==e.category()&&t.push(e.category()),t.push(e),i=e.category())})),t}onEscapeKeyPressed(e){const t=m.DOMUtilities.deepActiveElement(document);this.editingRow&&t&&"INPUT"===t.nodeName&&this.editingRow.onEscapeKeyPressed(e)}update(){this.editingItem&&this.stopEditing(this.editingItem),this.list.refreshAllItems(),this.list.selectedItem()||this.list.selectItem(this.items.at(0))}willHide(){this.editingItem&&this.stopEditing(this.editingItem)}wasShown(){super.wasShown(),this.registerCSSFiles([D])}}class W{isEditing;settingsTab;item;element;editedShortcuts;shortcutInputs;shortcuts;elementToFocus;confirmButton;addShortcutLinkContainer;errorMessageElement;secondKeyTimeout;constructor(e,t,i){this.isEditing=Boolean(i),this.settingsTab=t,this.item=e,this.element=document.createElement("div"),this.element.setAttribute("jslog",`${a.item().context(e.id()).track({keydown:"Escape"})}`),this.editedShortcuts=new Map,this.shortcutInputs=new Map,this.shortcuts=r.ShortcutRegistry.ShortcutRegistry.instance().shortcutsForAction(e.id()),this.elementToFocus=null,this.confirmButton=null,this.addShortcutLinkContainer=null,this.errorMessageElement=null,this.secondKeyTimeout=null,this.update()}focus(){this.elementToFocus&&this.elementToFocus.focus()}update(){this.element.removeChildren(),this.elementToFocus=null,this.shortcutInputs.clear(),this.element.classList.toggle("keybinds-editing",this.isEditing),this.element.createChild("div","keybinds-action-name keybinds-list-text").textContent=this.item.title(),this.shortcuts.forEach(this.createShortcutRow,this),0===this.shortcuts.length&&this.createEmptyInfo(),this.isEditing&&this.setupEditor()}createEmptyInfo(){if(r.ShortcutRegistry.ShortcutRegistry.instance().actionHasDefaultShortcut(this.item.id())){const e=n.Icon.create("keyboard-pen","keybinds-modified");r.ARIAUtils.setLabel(e,j(O.shortcutModified)),this.element.appendChild(e)}if(!this.isEditing){const e=this.element.createChild("div","keybinds-shortcut keybinds-list-text");r.ARIAUtils.setLabel(e,j(O.noShortcutForAction)),this.element.appendChild(this.createEditButton())}}setupEditor(){this.addShortcutLinkContainer=this.element.createChild("div","keybinds-shortcut");const e=r.UIUtils.createTextButton(j(O.addAShortcut),this.addShortcut.bind(this),{jslogContext:"add-shortcut"});this.addShortcutLinkContainer.appendChild(e),this.elementToFocus||(this.elementToFocus=e),this.errorMessageElement=this.element.createChild("div","keybinds-info keybinds-error hidden"),r.ARIAUtils.markAsAlert(this.errorMessageElement),this.element.appendChild(this.createIconButton(j(O.ResetShortcutsForAction),"undo","","undo",this.resetShortcutsToDefaults.bind(this))),this.confirmButton=this.createIconButton(j(O.confirmChanges),"checkmark","keybinds-confirm-button","confirm",(()=>{this.settingsTab.commitChanges(this.item,this.editedShortcuts),r.ARIAUtils.alert(j(O.shortcutChangesApplied,{PH1:this.item.title()}))})),this.element.appendChild(this.confirmButton),this.element.appendChild(this.createIconButton(j(O.discardChanges),"cross","keybinds-cancel-button","cancel",(()=>{this.settingsTab.stopEditing(this.item),r.ARIAUtils.alert(j(O.shortcutChangesDiscared))}))),this.element.addEventListener("keydown",(e=>{m.KeyboardUtilities.isEscKey(e)&&(this.settingsTab.stopEditing(this.item),e.consume(!0))}))}addShortcut(){const e=new r.KeyboardShortcut.KeyboardShortcut([],this.item.id(),"UnsetShortcut");this.shortcuts.push(e),this.update();const t=this.shortcutInputs.get(e);t&&t.focus()}createShortcutRow(e,t){if(this.editedShortcuts.has(e)&&!this.editedShortcuts.get(e))return;let i;"UnsetShortcut"===e.type||e.isDefault()||(i=n.Icon.create("keyboard-pen","keybinds-modified"),r.ARIAUtils.setLabel(i,j(O.shortcutModified)),this.element.appendChild(i));const s=this.element.createChild("div","keybinds-shortcut keybinds-list-text");if(this.isEditing){const t=s.createChild("input","harmony-input");t.setAttribute("jslog",`${a.textField().track({change:!0})}`),t.spellcheck=!1,t.maxLength=0,this.shortcutInputs.set(e,t),this.elementToFocus||(this.elementToFocus=t),t.value=e.title();const i=this.editedShortcuts.get(e);i&&(t.value=this.shortcutInputTextForDescriptors(i)),t.addEventListener("keydown",this.onShortcutInputKeyDown.bind(this,e,t)),t.addEventListener("blur",(()=>{null!==this.secondKeyTimeout&&(clearTimeout(this.secondKeyTimeout),this.secondKeyTimeout=null)})),s.appendChild(this.createIconButton(j(O.removeShortcut),"bin","keybinds-delete-button","delete",(()=>{const t=this.shortcuts.indexOf(e);e.isDefault()||this.shortcuts.splice(t,1),this.editedShortcuts.set(e,null),this.update(),this.focus(),this.validateInputs(),r.ARIAUtils.alert(j(O.shortcutRemoved,{PH1:this.item.title()}))})))}else{e.descriptors.flatMap((e=>e.name.split(" + "))).forEach((e=>{s.createChild("span","keybinds-key").textContent=e})),0===t&&this.element.appendChild(this.createEditButton())}}createEditButton(){return this.createIconButton(j(O.editShortcut),"edit","keybinds-edit-button","edit",(()=>this.settingsTab.startEditing(this.item)))}createIconButton(e,t,i,s,n){const o=new c.Button.Button;return o.data={variant:"icon",iconName:t,jslogContext:s,title:e},o.addEventListener("click",n),r.ARIAUtils.setLabel(o,e),i&&o.classList.add(i),o}onShortcutInputKeyDown(e,t,i){if("Tab"!==i.key){const s=this.descriptorForEvent(i),n=this.editedShortcuts.get(e)||[];this.editedShortcuts.set(e,n);const o=2===n.length&&r.KeyboardShortcut.KeyboardShortcut.isModifier(n[1].key);2===n.length&&!o&&n.splice(0,2),this.secondKeyTimeout?(clearTimeout(this.secondKeyTimeout),this.secondKeyTimeout=null,n.push(s)):o?n[1]=s:r.KeyboardShortcut.KeyboardShortcut.isModifier(s.key)?n[0]=s:(n[0]=s,this.secondKeyTimeout=window.setTimeout((()=>{this.secondKeyTimeout=null}),r.ShortcutRegistry.KeyTimeout)),t.value=this.shortcutInputTextForDescriptors(n),this.validateInputs(),i.consume(!0)}}descriptorForEvent(e){const t=r.KeyboardShortcut.KeyboardShortcut.makeKeyFromEvent(e),i=r.KeyboardShortcut.KeyboardShortcut.keyCodeAndModifiersFromKey(t);let s=r.KeyboardShortcut.Keys[e.key]||r.KeyboardShortcut.KeyBindings[e.key];if(!s&&!/^[a-z]$/i.test(e.key)){const t=e.code;s=r.KeyboardShortcut.Keys[t]||r.KeyboardShortcut.KeyBindings[t],t.startsWith("Digit")?s=t.slice(5):t.startsWith("Key")&&(s=t.slice(3))}return r.KeyboardShortcut.KeyboardShortcut.makeDescriptor(s||e.key,i.modifiers)}shortcutInputTextForDescriptors(e){return e.map((e=>e.name)).join(" ")}resetShortcutsToDefaults(){this.editedShortcuts.clear();for(const e of this.shortcuts)if("UnsetShortcut"===e.type){const t=this.shortcuts.indexOf(e);this.shortcuts.splice(t,1)}else"UserShortcut"===e.type&&this.editedShortcuts.set(e,null);r.ShortcutRegistry.ShortcutRegistry.instance().disabledDefaultsForAction(this.item.id()).forEach((e=>{this.shortcuts.includes(e)||(this.shortcuts.push(e),this.editedShortcuts.set(e,e.descriptors))})),this.update(),this.focus(),r.ARIAUtils.alert(j(O.shortcutChangesRestored,{PH1:this.item.title()}))}onEscapeKeyPressed(e){const t=m.DOMUtilities.deepActiveElement(document);for(const[i,s]of this.shortcutInputs.entries())t===s&&this.onShortcutInputKeyDown(i,s,e)}validateInputs(){const e=this.confirmButton,t=this.errorMessageElement;e&&t&&(e.disabled=!1,t.classList.add("hidden"),this.shortcutInputs.forEach(((i,s)=>{const n=this.editedShortcuts.get(s);if(!n)return;if(n.some((e=>r.KeyboardShortcut.KeyboardShortcut.isModifier(e.key))))return e.disabled=!0,i.classList.add("error-input"),r.ARIAUtils.setInvalid(i,!0),t.classList.remove("hidden"),void(t.textContent=j(O.shortcutsCannotContainOnly));const o=r.ShortcutRegistry.ShortcutRegistry.instance().actionsForDescriptors(n).filter((e=>e!==this.item.id()));if(o.length){if(e.disabled=!0,i.classList.add("error-input"),r.ARIAUtils.setInvalid(i,!0),t.classList.remove("hidden"),!r.ActionRegistry.ActionRegistry.instance().hasAction(o[0]))return;const s=r.ActionRegistry.ActionRegistry.instance().getAction(o[0]),n=s.title(),a=s.category();t.textContent=j(O.thisShortcutIsInUseByS,{PH1:a,PH2:n})}else i.classList.remove("error-input"),r.ARIAUtils.setInvalid(i,!1)})))}}var V=Object.freeze({__proto__:null,KeybindsSettingsTab:G,ShortcutListItem:W});export{B as AISettingsTab,U as FrameworkIgnoreListSettingsTab,V as KeybindsSettingsTab,C as SettingsScreen};
