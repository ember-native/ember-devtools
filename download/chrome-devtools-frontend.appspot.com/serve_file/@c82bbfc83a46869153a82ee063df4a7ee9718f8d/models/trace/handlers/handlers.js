import*as e from"../helpers/helpers.js";import*as t from"../types/types.js";import*as n from"../../../core/platform/platform.js";import*as r from"../../cpu_profile/cpu_profile.js";const i=[],a=[];let s=1;var o=Object.freeze({__proto__:null,reset:function(){i.length=0,a.length=0},handleEvent:function(e){t.TraceEvents.isTraceEventAnimation(e)&&i.push(e)},finalize:async function(){const t=e.Trace.createMatchedSortedSyntheticEvents(i);a.push(...t),s=3},data:function(){if(3!==s)throw new Error("Animation handler is not finalized");return{animations:a}}});const c=new Map,d=new Map,l=new Map,u=new Map,m=new Map;function f(e){switch(e){case"seller":return"seller";case"bidder":return"bidder";default:return"unknown"}}function g(t){return e.SyntheticEvents.SyntheticEventsManager.registerSyntheticBasedEvent({rawSourceEvent:t,name:"SyntheticAuctionWorkletEvent",s:"t",cat:t.cat,tid:t.tid,ts:t.ts,ph:"I",pid:t.args.data.pid,host:t.args.data.host,target:t.args.data.target,type:f(t.args.data.type)})}function T(){return{worklets:new Map(l)}}var v=Object.freeze({__proto__:null,reset:function(){c.clear(),d.clear(),l.clear(),u.clear(),m.clear()},handleEvent:function(e){if(t.TraceEvents.isTraceEventAuctionWorkletRunningInProcess(e))c.set(e.args.data.pid,e);else if(t.TraceEvents.isTraceEventAuctionWorkletDoneWithProcess(e))d.set(e.args.data.pid,e);else if(t.TraceEvents.isThreadName(e)){if("auction_worklet.CrUtilityMain"===e.args.name)return void u.set(e.pid,e);"AuctionV8HelperThread"===e.args.name&&m.set(e.pid,e)}},finalize:async function(){for(const[e,t]of u){const n=m.get(e);if(!n)continue;const r=c.get(e),i=d.get(e);let a=null;r?(a={...g(r),args:{data:{runningInProcessEvent:r,utilityThread:t,v8HelperThread:n}}},i&&(a.args.data.doneWithProcessEvent=i)):i&&(a={...g(i),args:{data:{doneWithProcessEvent:i,utilityThread:t,v8HelperThread:n}}},r&&(a.args.data.runningInProcessEvent=r)),null!==a&&l.set(e,a)}},data:T});let h=1;const p=[],E=new Map,w=new Map,S=new Map,M=new Map,I=[],y=[],F=[];function P(e,t){return t+"@"+e}var _=Object.freeze({__proto__:null,EnhancedTracesVersion:1,initialize:function(){if(1!==h)throw new Error("Enhanced Traces Handler was not reset");h=2},reset:function(){p.length=0,E.clear(),w.clear(),S.clear(),M.clear(),I.length=0,y.length=0,F.length=0,h=1},handleEvent:function(e){if(2!==h)throw new Error("Enhanced Traces Handler is not initialized while handling event");if(t.TraceEvents.isTraceEventTargetRundown(e)){const t=e.args?.data;E.set(P(t.isolate,t.scriptId),t.v8context),I.find((e=>e.targetId===t.frame))||I.push({targetId:t.frame,type:t.frameType,isolate:t.isolate,pid:e.pid,url:t.url}),y.find((e=>e.v8Context===t.v8context))||y.push({id:-1,origin:t.origin,v8Context:t.v8context,auxData:{frameId:t.frame,isDefault:t.isDefault,type:t.contextType},isolate:t.isolate})}else if(t.TraceEvents.isTraceEventScriptRundown(e)){p.push(e);const t=e.args.data;F.find((e=>e.scriptId===t.scriptId&&e.isolate===t.isolate))||F.push({scriptId:t.scriptId,isolate:t.isolate,executionContextId:t.executionContextId,startLine:t.startLine,startColumn:t.startColumn,endLine:t.endLine,endColumn:t.endColumn,hash:t.hash,isModule:t.isModule,url:t.url,hasSourceUrl:t.hasSourceUrl,sourceMapUrl:t.sourceMapUrl})}else if(t.TraceEvents.isTraceEventScriptRundownSource(e)){const t=e.args.data,n=P(t.isolate,t.scriptId);if("splitIndex"in t&&"splitCount"in t){S.has(n)||S.set(n,new Array(t.splitCount).fill(""));const e=S.get(n);e&&t.sourceText&&(e[t.splitIndex]=t.sourceText)}else t.sourceText&&w.set(n,t.sourceText),t.length&&M.set(n,t.length)}},finalize:async function(){if(2!==h)throw new Error("Enhanced Traces Handler is not initialized while being finalized");const e=new Map;p.forEach((t=>{const n=t.args.data,r=E.get(P(n.isolate,n.scriptId));r&&e.set(r,n.executionContextId)})),y.forEach((t=>{if(t.v8Context){const n=e.get(t.v8Context);n&&(t.id=n)}})),F.forEach((e=>{const t=P(e.isolate,e.scriptId);if(w.has(t))e.sourceText=w.get(t),e.length=M.get(t);else if(S.has(t)){const n=S.get(t);n&&(e.sourceText=n.join(""),e.length=e.sourceText.length)}e.auxData=y.find((t=>t.id===e.executionContextId&&t.isolate===e.isolate))?.auxData})),h=3},data:function(){if(3!==h)throw new Error("Enhanced Traces Handler is not finalized");return{targets:I,executionContexts:y,scripts:F}}});let C=[];const R=[],D=[],k=[],L=[];let b=1;const N=["workerStart","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","navigationStart","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","commitNavigationEnd","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domLoading","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd"];function z(){if(3!==b)throw new Error("UserTimings handler is not finalized");return{performanceMeasures:C.filter((e=>"blink.user_timing"===e.cat)),consoleTimings:C.filter((e=>"blink.console"===e.cat)),performanceMarks:[...D],timestampEvents:[...L]}}var x=Object.freeze({__proto__:null,reset:function(){C.length=0,R.length=0,D.length=0,k.length=0,L.length=0,b=2},handleEvent:function(e){if(2!==b)throw new Error("UserTimings handler is not initialized");N.includes(e.name)||(t.TraceEvents.isTraceEventPerformanceMeasure(e)?R.push(e):(t.TraceEvents.isTraceEventPerformanceMark(e)&&D.push(e),t.TraceEvents.isTraceEventConsoleTime(e)&&k.push(e),t.TraceEvents.isTraceEventTimeStamp(e)&&L.push(e)))},finalize:async function(){if(2!==b)throw new Error("UserTimings handler is not initialized");const t=[...R,...k];C=e.Trace.createMatchedSortedSyntheticEvents(t),b=3},data:z});const W=[],O=[],B=[],U=new Map;let q=1;function H(n){for(const r of n){const n=A(r);if(!n)continue;const i={name:r.name,ph:"X",pid:t.TraceEvents.ProcessID(0),tid:t.TraceEvents.ThreadID(0),ts:r.ts,dur:r.dur,cat:"devtools.extension",args:n,rawSourceEvent:t.TraceEvents.isSyntheticUserTiming(r)?r.rawSourceEvent:r};if(t.Extensions.isExtensionPayloadMarker(n)){const t=e.SyntheticEvents.SyntheticEventsManager.getActiveManager().registerSyntheticBasedEvent(i);B.push(t)}else if(t.Extensions.isExtensionPayloadTrackEntry(i.args)){const t=e.SyntheticEvents.SyntheticEventsManager.getActiveManager().registerSyntheticBasedEvent(i);W.push(t)}else;}}function A(e){const n=t.TraceEvents.isTraceEventPerformanceMark(e)?e.args.data?.detail:e.args.data.beginEvent.args.detail;if(!n)return null;try{const e=JSON.parse(n);return"devtools"in e&&t.Extensions.isValidExtensionPayload(e.devtools)?e.devtools:null}catch(e){return null}}var j=Object.freeze({__proto__:null,handleEvent:function(e){},reset:function(){q=2,W.length=0,O.length=0,B.length=0,U.clear()},finalize:async function(){if(2!==q)throw new Error("ExtensionTraceData handler is not initialized");!function(){const t=z().performanceMeasures,n=z().performanceMarks;H(e.Trace.mergeEventsInOrder(t,n)),e.Extensions.buildTrackDataFromExtensionEntries(W,O,U)}(),q=3},extractExtensionEntries:H,extensionDataInTiming:A,data:function(){if(3!==q)throw new Error("ExtensionTraceData handler is not finalized");return{entryToNode:U,extensionTrackData:[...O],extensionMarkers:[...B]}},deps:function(){return["UserTimings"]}});const G=new Map;let V="",X="";const $=new Map;let Y=t.TraceEvents.ProcessID(-1),K=t.TraceEvents.ThreadID(-1),Q=t.TraceEvents.ProcessID(-1),J=t.TraceEvents.ThreadID(-1),Z=null;const ee=new Map,te=new Set,ne={min:t.Timing.MicroSeconds(Number.POSITIVE_INFINITY),max:t.Timing.MicroSeconds(Number.NEGATIVE_INFINITY),range:t.Timing.MicroSeconds(Number.POSITIVE_INFINITY)},re=new Map,ie=new Map,ae=[],se=new Map;let oe=t.Timing.MicroSeconds(-1);const ce=new Set(["B","E","X","I"]);let de=1,le=!0;const ue=new Set(["TracingStartedInPage","TracingSessionIdForWorker","TracingStartedInBrowser"]);function me(e,r){n.MapUtilities.getWithDefault($,r.processId,(()=>new Map)).set(r.frame,r);const i=n.MapUtilities.getWithDefault(G,r.frame,(()=>new Map)),a=n.MapUtilities.getWithDefault(i,r.processId,(()=>[])),s=a.at(-1);s&&s.frame.url===r.url||a.push({frame:r,window:{min:e.ts,max:t.Timing.MicroSeconds(0),range:t.Timing.MicroSeconds(0)}})}function fe(){if(3!==de)throw new Error("Meta Handler is not finalized");return{traceBounds:{...ne},browserProcessId:Y,browserThreadId:K,processNames:ee,gpuProcessId:Q,gpuThreadId:J===t.TraceEvents.ThreadID(-1)?void 0:J,viewportRect:Z||void 0,mainFrameId:V,mainFrameURL:X,navigationsByFrameId:re,navigationsByNavigationId:ie,threadsInProcess:se,rendererProcessesByFrame:G,topLevelRendererIds:te,frameByProcessId:$,mainFrameNavigations:ae,traceIsGeneric:le}}var ge=Object.freeze({__proto__:null,reset:function(){re.clear(),ie.clear(),ee.clear(),ae.length=0,Y=t.TraceEvents.ProcessID(-1),K=t.TraceEvents.ThreadID(-1),Q=t.TraceEvents.ProcessID(-1),J=t.TraceEvents.ThreadID(-1),Z=null,te.clear(),se.clear(),G.clear(),$.clear(),ne.min=t.Timing.MicroSeconds(Number.POSITIVE_INFINITY),ne.max=t.Timing.MicroSeconds(Number.NEGATIVE_INFINITY),ne.range=t.Timing.MicroSeconds(Number.POSITIVE_INFINITY),oe=t.Timing.MicroSeconds(-1),le=!0,de=1},initialize:function(){if(1!==de)throw new Error("Meta Handler was not reset");de=2},handleEvent:function(e){if(2!==de)throw new Error("Meta Handler is not initialized");if(le&&ue.has(e.name)&&(le=!1),t.TraceEvents.isProcessName(e)&&ee.set(e.pid,e),0!==e.ts&&!e.name.endsWith("::UMA")&&ce.has(e.ph)){ne.min=t.Timing.MicroSeconds(Math.min(e.ts,ne.min));const n=e.dur||t.Timing.MicroSeconds(0);ne.max=t.Timing.MicroSeconds(Math.max(e.ts+n,ne.max))}if(!t.TraceEvents.isProcessName(e)||"Browser"!==e.args.name&&"HeadlessBrowser"!==e.args.name)if(!t.TraceEvents.isProcessName(e)||"Gpu"!==e.args.name&&"GPU Process"!==e.args.name)if(t.TraceEvents.isThreadName(e)&&"CrGpuMain"===e.args.name)J=e.tid;else{if(t.TraceEvents.isThreadName(e)&&"CrBrowserMain"===e.args.name&&(K=e.tid),t.TraceEvents.isTraceEventMainFrameViewport(e)&&null===Z){const t=e.args.data.viewport_rect,n=t[0],r=t[1],i=t[2],a=t[5];Z=new DOMRect(n,r,i,a)}if(t.TraceEvents.isTraceEventTracingStartedInBrowser(e)){if(oe=e.ts,!e.args.data)throw new Error("No frames found in trace data");for(const t of e.args.data.frames??[]){me(e,t),t.parent||te.add(t.processId);const n="isOutermostMainFrame"in t;"isInPrimaryMainFrame"in t&&n?t.isInPrimaryMainFrame&&t.isOutermostMainFrame&&(V=t.frame,X=t.url):n?t.isOutermostMainFrame&&(V=t.frame,X=t.url):!t.parent&&t.url&&(V=t.frame,X=t.url)}}else if(t.TraceEvents.isTraceEventFrameCommittedInBrowser(e)){const t=e.args.data;if(!t)return;if(me(e,t),t.parent)return;te.add(t.processId)}else if(t.TraceEvents.isTraceEventCommitLoad(e)){const t=e.args.data;if(!t)return;const{frame:n,name:r,url:i}=t;me(e,{processId:e.pid,frame:n,name:r,url:i})}else if(t.TraceEvents.isThreadName(e)){n.MapUtilities.getWithDefault(se,e.pid,(()=>new Map)).set(e.tid,e)}else if(t.TraceEvents.isTraceEventNavigationStartWithURL(e)&&e.args.data){const t=e.args.data.navigationId;if(ie.has(t))return;ie.set(t,e);const n=e.args.frame,r=re.get(n)||[];return r.push(e),re.set(n,r),void(n===V&&ae.push(e))}}else Q=e.pid;else Y=e.pid},finalize:async function(){if(2!==de)throw new Error("Handler is not initialized");oe>=0&&(ne.min=oe),ne.range=t.Timing.MicroSeconds(ne.max-ne.min);for(const[,e]of G){const n=[...e.values()].flat();for(let e=0;e<n.length;e++){const r=n[e],i=n[e+1];i?(r.window.max=t.Timing.MicroSeconds(i.window.min-1),r.window.range=t.Timing.MicroSeconds(r.window.max-r.window.min)):(r.window.max=t.Timing.MicroSeconds(ne.max),r.window.range=t.Timing.MicroSeconds(ne.max-r.window.min))}}for(const[e,t]of re)if(!G.has(e)){re.delete(e);for(const e of t)e.args.data&&ie.delete(e.args.data.navigationId)}const n=ae.at(0),r=e.Timing.secondsToMicroseconds(t.Timing.Seconds(.5));if(n){const e=n.ts-ne.min<r;n.args.data?.isOutermostMainFrame&&n.args.data?.documentLoaderURL&&e&&(X=n.args.data.documentLoaderURL)}de=3},data:fe});let Te=1;const ve=[],he=[],pe=new Map;let Ee={},we=null;const Se=[],Me=[];function Ie(){return{paints:ve,snapshots:he,paintsToSnapshots:pe}}var ye=Object.freeze({__proto__:null,reset:function(){Te=1,ve.length=0,he.length=0,pe.clear(),Ee={},we=null,Se.length=0,Me.length=0},initialize:function(){if(1!==Te)throw new Error("LayerTree Handler was not reset before being initialized");Te=2},handleEvent:function(e){(t.TraceEvents.isTraceEventPaint(e)||t.TraceEvents.isTraceEventDisplayListItemListSnapshot(e)||t.TraceEvents.isTraceEventUpdateLayer(e)||t.TraceEvents.isTraceEventSetLayerId(e))&&Me.push(e)},finalize:async function(){if(2!==Te)throw new Error("LayerTree Handler is not initialized");const n=fe();e.Trace.sortTraceEventsInPlace(Me);for(const e of Me)if(t.TraceEvents.isTraceEventSetLayerId(e)){if(n.mainFrameId!==e.args.data.frame)continue;we=e.args.data.layerTreeId}else if(t.TraceEvents.isTraceEventUpdateLayer(e))Se.push(e);else{if(t.TraceEvents.isTraceEventPaint(e)){if(!e.args.data.layerId)continue;ve.push(e),Ee[e.args.data.layerId]=e;continue}if(t.TraceEvents.isTraceEventDisplayListItemListSnapshot(e)){let t=null;for(let n=Se.length-1;n>-1;n--){const r=Se[n];if(r.pid===e.pid&&r.tid===e.tid){t=r;break}}if(!t)continue;if(t.args.layerTreeId!==we)continue;const n=Ee[t.args.layerId];if(!n)continue;he.push(e),pe.set(n,e)}}Te=3},data:Ie,deps:function(){return["Meta"]}});const Fe=new Map,Pe=new Map,_e=new Map,Ce=new Map;let Re=1;function De(){if(3!==Re)throw new Error("Samples Handler is not finalized");return{profilesInProcess:Pe,entryToNode:_e}}function ke(e,t){const r=n.MapUtilities.getWithDefault(Ce,e,(()=>new Map));return n.MapUtilities.getWithDefault(r,t,(()=>({rawProfile:{startTime:0,endTime:0,nodes:[],samples:[],timeDeltas:[],lines:[]},profileId:t})))}var Le=Object.freeze({__proto__:null,reset:function(){Fe.clear(),Ce.clear(),Pe.clear(),_e.clear(),Re=1},initialize:function(){if(1!==Re)throw new Error("Samples Handler was not reset");Re=2},handleEvent:function(e){if(2!==Re)throw new Error("Samples Handler is not initialized");if(t.TraceEvents.isSyntheticCpuProfile(e)){const t=e.pid,n=e.tid,r=ke(t,"0x1");return r.rawProfile=e.args.data.cpuProfile,void(r.threadId=n)}if(t.TraceEvents.isTraceEventProfile(e)){const t=ke(e.pid,e.id);return t.rawProfile.startTime=e.ts,void(t.threadId=e.tid)}if(t.TraceEvents.isTraceEventProfileChunk(e)){const t=ke(e.pid,e.id).rawProfile,n=e.args?.data?.cpuProfile||{samples:[]},r=n?.samples||[],i=[];for(const e of n?.nodes||[]){const t=void 0===e.callFrame.lineNumber?-1:e.callFrame.lineNumber,n=void 0===e.callFrame.columnNumber?-1:e.callFrame.columnNumber,r=String(e.callFrame.scriptId),a=e.callFrame.url||"",s={...e,callFrame:{...e.callFrame,url:a,lineNumber:t,columnNumber:n,scriptId:r}};i.push(s)}const a=e.args.data?.timeDeltas||[],s=e.args.data?.lines||Array(r.length).fill(0);if(t.nodes.push(...i),t.samples?.push(...r),t.timeDeltas?.push(...a),t.lines?.push(...s),t.samples&&t.timeDeltas&&t.samples.length!==t.timeDeltas.length)return void console.error("Failed to parse CPU profile.");if(!t.endTime&&t.timeDeltas){const e=t.timeDeltas;t.endTime=e.reduce(((e,t)=>e+t),t.startTime)}}else;},finalize:async function(){if(2!==Re)throw new Error("Samples Handler is not initialized");!function(){for(const[s,o]of Ce)for(const[c,d]of o){const l=d.threadId;if(!d.rawProfile.nodes.length||void 0===l)continue;const u=[],m=new r.CPUProfileDataModel.CPUProfileDataModel(d.rawProfile),f=e.TreeHelpers.makeEmptyTraceEntryTree();f.maxDepth=m.maxDepth;const g={rawProfile:d.rawProfile,parsedProfile:m,profileCalls:[],profileTree:f,profileId:c},T=n.MapUtilities.getWithDefault(Pe,s,(()=>new Map));function i(n,r,i,a){if(void 0===l)return;const o=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(a)),d=r.id,m=e.Trace.makeProfileCall(r,c,i,o,s,l);g.profileCalls.push(m),u.push(g.profileCalls.length-1);const f=e.TreeHelpers.makeEmptyTraceEntryNode(m,d);_e.set(m,f),f.depth=n,1===u.length&&g.profileTree?.roots.add(f)}function a(n,r,i,a,s,o){const d=u.pop(),l=void 0!==d&&g.profileCalls[d];if(!l)return;const{callFrame:m,ts:f,pid:T,tid:v}=l,h=_e.get(l);if(void 0===m||void 0===f||void 0===T||void 0===c||void 0===v||void 0===h)return;const p=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(s)),E=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(o));l.dur=p,h.selfTime=E;const w=u.at(-1),S=void 0!==w&&g.profileCalls.at(w),M=S&&_e.get(S);M&&(h.parent=M,M.children.push(h))}m.forEachFrame(i,a),T.set(l,g)}}(),Re=3},data:De,getProfileCallFunctionName:function(e,t){const n=e.profilesInProcess.get(t.pid)?.get(t.tid),r=n?.parsedProfile.nodeById(t.nodeId);return r?.functionName?r.functionName:t.callFrame.functionName}});const be=new Map,Ne=Array(),ze=new Map;let xe=[];const We=[];let Oe=1,Be=t.Configuration.defaults();const Ue=()=>({url:null,isOnMainFrame:!1,threads:new Map}),qe=()=>({name:null,entries:[],profileCalls:[]}),He=(e,t)=>n.MapUtilities.getWithDefault(e,t,Ue),Ae=(e,t)=>n.MapUtilities.getWithDefault(e.threads,t,qe);function je(){if(3!==Oe)throw new Error("Renderer Handler is not finalized");return{processes:new Map(be),compositorTileWorkers:new Map(Ge()),entryToNode:new Map(ze),allTraceEntries:[...xe]}}function Ge(){const e=new Map;for(const t of Ne){const n=e.get(t.pid)||[];n.push(t.tid),e.set(t.pid,n)}return e}function Ve(e,t,n,r){Xe(e,n),$e(e,t,n),Ye(e,n,r)}function Xe(e,t){for(const n of t.values())for(const[t,r]of n)for(const n of r.flat()){const r=He(e,t);if(null===r.url||"about:blank"===r.url)try{new URL(n.frame.url),r.url=n.frame.url}catch(e){r.url=null}}}function $e(e,t,n){for(const[r,i]of n)for(const[n]of i){const i=He(e,n);r===t&&(i.isOnMainFrame=!0)}}function Ye(e,t,n){for(const[t,r]of e)for(const[e,i]of n.get(t)??[]){Ae(r,e).name=i?.args.name??`${e}`}}function Ke(e){const t=T().worklets;if(!fe().traceIsGeneric)for(const[n,r]of e)if(null!==r.url);else{const i=t.get(n);i?r.url=i.host:e.delete(n)}}function Qe(e){for(const[,t]of e)for(const[e,n]of t.threads)n.tree?.roots.size||t.threads.delete(e)}function Je(t,n){const r=De();for(const[i,a]of t)for(const[t,s]of a.threads){if(!s.entries.length){s.tree=e.TreeHelpers.makeEmptyTraceEntryTree();continue}e.Trace.sortTraceEventsInPlace(s.entries);const a=r.profilesInProcess.get(i)?.get(t);if(a){const n=a.parsedProfile,r=n&&new e.SamplesIntegrator.SamplesIntegrator(n,a.profileId,i,t,Be),o=r?.buildProfileCalls(s.entries);if(r&&o){xe=[...xe,...o],s.entries=e.Trace.mergeEventsInOrder(s.entries,o),s.profileCalls=o;const t=r.jsSampleEvents;t&&(xe=[...xe,...t],s.entries=e.Trace.mergeEventsInOrder(s.entries,t))}}const o=e.TreeHelpers.treify(s.entries,n);s.tree=o.tree;for(const[e,t]of o.entryToNode)ze.set(e,t)}}function Ze(e){if(t.TraceEvents.isTraceEventEnd(e)){const n=We.pop();return n?n.name!==e.name||n.cat!==e.cat?(console.error("Begin/End events mismatch at "+n.ts+" ("+n.name+") vs. "+e.ts+" ("+e.name+")"),null):(n.dur=t.Timing.MicroSeconds(e.ts-n.ts),null):null}const n={...e,ph:"X",dur:t.Timing.MicroSeconds(0)};return We.push(n),n}var et=Object.freeze({__proto__:null,handleUserConfig:function(e){Be=e},reset:function(){be.clear(),ze.clear(),xe.length=0,We.length=0,Ne.length=0,Oe=1},initialize:function(){if(1!==Oe)throw new Error("Renderer Handler was not reset");Oe=2},handleEvent:function(e){if(2!==Oe)throw new Error("Renderer Handler is not initialized");if(t.TraceEvents.isThreadName(e)&&e.args.name?.startsWith("CompositorTileWorker")&&Ne.push({pid:e.pid,tid:e.tid}),t.TraceEvents.isTraceEventBegin(e)||t.TraceEvents.isTraceEventEnd(e)){const t=He(be,e.pid),n=Ae(t,e.tid),r=Ze(e);if(!r)return;return n.entries.push(r),void xe.push(r)}if(t.TraceEvents.isTraceEventInstant(e)||t.TraceEvents.isTraceEventComplete(e)){const t=He(be,e.pid);Ae(t,e.tid).entries.push(e),xe.push(e)}},finalize:async function(){if(2!==Oe)throw new Error("Renderer Handler is not initialized");const{mainFrameId:t,rendererProcessesByFrame:n,threadsInProcess:r}=fe();Ve(be,t,n,r),Ke(be),Je(be),Qe(be),e.Trace.sortTraceEventsInPlace(xe),Oe=3},data:je,assignMeta:Ve,assignOrigin:Xe,assignIsMainFrame:$e,assignThreadName:Ye,sanitizeProcesses:Ke,sanitizeThreads:Qe,buildHierarchy:Je,makeCompleteEvent:Ze,deps:function(){return["Meta","Samples","AuctionWorklets"]}});function tt(e,t,n){let r="OTHER";return"CrRendererMain"===t.name?r="MAIN_THREAD":"DedicatedWorker thread"===t.name?r="WORKER":t.name?.startsWith("CompositorTileWorker")?r="RASTERIZER":n.worklets.has(e)?r="AUCTION_WORKLET":t.name?.startsWith("ThreadPool")&&(r="THREAD_POOL"),r}function nt(e,t){const n=[];if(e.processes.size)for(const[r,i]of e.processes)for(const[a,s]of i.threads){if(!s.tree)continue;const o=tt(r,s,t);n.push({name:s.name,pid:r,tid:a,processIsOnMainFrame:i.isOnMainFrame,entries:s.entries,tree:s.tree,type:o,entryToNode:e.entryToNode})}return n}var rt=Object.freeze({__proto__:null,threadsInRenderer:nt,threadsInTrace:function(e){const t=nt(e.Renderer,e.AuctionWorklets);if(t.length)return t;const n=[];if(e.Samples.profilesInProcess.size)for(const[t,r]of e.Samples.profilesInProcess)for(const[i,a]of r)a.profileTree&&n.push({pid:t,tid:i,name:null,entries:a.profileCalls,processIsOnMainFrame:!1,tree:a.profileTree,type:"CPU_PROFILE",entryToNode:e.Samples.entryToNode});return n}});let it=1;const at=[];let st=null;class ot{#e=[];#t={};#n=new ft;#r=null;#i=!1;#a=!1;#s=null;#o=null;#c=null;#d=null;#l=null;#u=null;#m=null;#f=null;#g=null;#T;constructor(e,t,n,r,i){const a=nt(t,n).filter((e=>"MAIN_THREAD"===e.type&&e.processIsOnMainFrame)).map((e=>({tid:e.tid,pid:e.pid,startTime:e.entries[0].ts})));this.#T=i,this.#v(e,a,r.mainFrameId)}framesById(){return this.#t}frames(){return this.#e}#h(e,t){this.#r||this.#p(e,t),this.#d=e,this.#n.addFrameIfNotExists(t,e,!1,!1)}#E(e,t,n){this.#r||this.#p(e,t),this.#n.addFrameIfNotExists(t,e,!0,n),this.#n.setDropped(t,!0),this.#n.setPartial(t,n)}#w(e,t){if(this.#r){if(this.#i||!this.#a){if(this.#l){(this.#o?this.#o.triggerTime:this.#d||this.#l)>this.#r.startTime&&(this.#r.idle=!0,this.#d=null),this.#l=null}const e=this.#n.processPendingBeginFramesOnDrawFrame(t);for(const n of e){const e=this.#r.idle;this.#p(n.startTime,t),e&&this.#o&&this.#S(),n.isDropped&&(this.#r.dropped=!0),n.isPartial&&(this.#r.isPartial=!0)}}this.#i=!1}else this.#p(e,t)}#M(){this.#r&&this.#o&&!this.#l&&this.#S()}#I(){this.#r&&(this.#a=!0)}#y(){this.#c&&(this.#o=this.#c,this.#c=null,this.#a=!1,this.#i=!0)}#F(e){this.#s=e}#P(e,t){t&&(this.#l=e)}#p(e,n){this.#r&&this.#_(this.#r,e),this.#r=new dt(n,e,t.Timing.MicroSeconds(e-fe().traceBounds.min))}#_(e,t){e.setLayerTree(this.#s),e.setEndTime(t),this.#s&&(this.#s.paints=e.paints);const n=this.#e[this.#e.length-1];this.#e.length&&n&&(e.startTime!==n.endTime||e.startTime>e.endTime)&&console.assert(!1,`Inconsistent frame time for frame ${this.#e.length} (${e.startTime} - ${e.endTime})`),this.#e.push(e),"number"==typeof e.mainFrameId&&(this.#t[e.mainFrameId]=e)}#S(){this.#o&&this.#r&&(this.#r.paints=this.#o.paints,this.#r.mainFrameId=this.#o.mainFrameId,this.#o=null)}#v(e,t,n){let r=0;this.#g=t.length&&t[0].tid||null,this.#f=t.length&&t[0].pid||null;for(let i=0;i<e.length;++i){for(;r+1<t.length&&t[r+1].startTime<=e[i].ts;)this.#g=t[++r].tid,this.#f=t[r].pid;this.#C(e[i],n)}this.#g=null,this.#f=null}#C(e,n){t.TraceEvents.isTraceEventSetLayerId(e)&&e.args.data.frame===n?this.#m=e.args.data.layerTreeId:t.TraceEvents.isTraceEventLayerTreeHostImplSnapshot(e)&&Number(e.id)===this.#m?this.#F({entry:e,paints:[]}):(function(e){return t.TraceEvents.isTraceEventSetLayerId(e)||t.TraceEvents.isTraceEventBeginFrame(e)||t.TraceEvents.isTraceEventDroppedFrame(e)||t.TraceEvents.isTraceEventRequestMainThreadFrame(e)||t.TraceEvents.isTraceEventBeginMainThreadFrame(e)||t.TraceEvents.isTraceEventNeedsBeginFrameChanged(e)||t.TraceEvents.isTraceEventCommit(e)||t.TraceEvents.isTraceEventCompositeLayers(e)||t.TraceEvents.isTraceEventActivateLayerTree(e)||t.TraceEvents.isTraceEventDrawFrame(e)}(e)&&this.#R(e),e.tid===this.#g&&e.pid===this.#f&&this.#D(e))}#R(e){e.args.layerTreeId===this.#m&&(t.TraceEvents.isTraceEventBeginFrame(e)?this.#h(e.ts,e.args.frameSeqId):t.TraceEvents.isTraceEventDrawFrame(e)?this.#w(e.ts,e.args.frameSeqId):t.TraceEvents.isTraceEventActivateLayerTree(e)?this.#M():t.TraceEvents.isTraceEventRequestMainThreadFrame(e)?this.#I():t.TraceEvents.isTraceEventNeedsBeginFrameChanged(e)?this.#P(e.ts,e.args.data&&Boolean(e.args.data.needsBeginFrame)):t.TraceEvents.isTraceEventDroppedFrame(e)&&this.#E(e.ts,e.args.frameSeqId,Boolean(e.args.hasPartialUpdate)))}#D(e){if(function(e){return"RunTask"===e.name&&e.cat.includes("disabled-by-default-devtools.timeline")}(e)&&(this.#u=e.ts),!this.#c&&ct.has(e.name)&&(this.#c=new ut(this.#u||e.ts)),this.#c){if(t.TraceEvents.isTraceEventBeginMainThreadFrame(e)&&e.args.data.frameId&&(this.#c.mainFrameId=e.args.data.frameId),t.TraceEvents.isTraceEventPaint(e)){const t=this.#T.paintsToSnapshots.get(e);t&&this.#c.paints.push(new lt(e,t))}(t.TraceEvents.isTraceEventCompositeLayers(e)||t.TraceEvents.isTraceEventCommit(e))&&e.args.layerTreeId===this.#m&&this.#y()}}}const ct=new Set(["ScheduleStyleRecalculation","InvalidateLayout","BeginMainThreadFrame","ScrollLayer"]);class dt{startTime;startTimeOffset;endTime;duration;idle;dropped;isPartial;layerTree;paints;mainFrameId;seqId;constructor(e,n,r){this.seqId=e,this.startTime=n,this.startTimeOffset=r,this.endTime=this.startTime,this.duration=t.Timing.MicroSeconds(0),this.idle=!1,this.dropped=!1,this.isPartial=!1,this.layerTree=null,this.paints=[],this.mainFrameId=void 0}setEndTime(e){this.endTime=e,this.duration=t.Timing.MicroSeconds(this.endTime-this.startTime)}setLayerTree(e){this.layerTree=e}}class lt{#k;#L;constructor(e,t){this.#k=e,this.#L=t}layerId(){return this.#k.args.data.layerId}event(){return this.#k}picture(){const e=this.#L.args.snapshot.params?.layer_rect,t=this.#L.args.snapshot.skp64;return e&&t?{rect:e,serializedPicture:t}:null}}class ut{paints;mainFrameId;triggerTime;constructor(e){this.paints=[],this.mainFrameId=void 0,this.triggerTime=e}}class mt{seqId;startTime;isDropped;isPartial;constructor(e,t,n,r){this.seqId=e,this.startTime=t,this.isDropped=n,this.isPartial=r}}class ft{queueFrames=[];mapFrames={};addFrameIfNotExists(e,t,n,r){e in this.mapFrames||(this.mapFrames[e]=new mt(e,t,n,r),this.queueFrames.push(e))}setDropped(e,t){e in this.mapFrames&&(this.mapFrames[e].isDropped=t)}setPartial(e,t){e in this.mapFrames&&(this.mapFrames[e].isPartial=t)}processPendingBeginFramesOnDrawFrame(e){const t=[];if(e in this.mapFrames){for(;this.queueFrames[0]!==e;){const e=this.queueFrames[0];this.mapFrames[e].isDropped&&t.push(this.mapFrames[e]),delete this.mapFrames[e],this.queueFrames.shift()}t.push(this.mapFrames[e]),delete this.mapFrames[e],this.queueFrames.shift()}return t}}var gt=Object.freeze({__proto__:null,reset:function(){it=1,at.length=0},initialize:function(){if(1!==it)throw new Error("FramesHandler was not reset before being initialized");it=2},handleEvent:function(e){at.push(e)},finalize:async function(){if(2!==it)throw new Error("FramesHandler is not initialized");e.Trace.sortTraceEventsInPlace(at);const t=new ot(at,je(),T(),fe(),Ie());st=t},data:function(){return{frames:st?Array.from(st.frames()):[],framesById:st?{...st.framesById()}:{}}},deps:function(){return["Meta","Renderer","AuctionWorklets","LayerTree"]},TimelineFrameModel:ot,TimelineFrame:dt,LayerPaintEvent:lt,PendingFrame:ut,TimelineFrameBeginFrameQueue:ft,framesWithinWindow:function(e,t,r){const i=n.ArrayUtilities.lowerBound(e,t||0,((e,t)=>e-t.endTime)),a=n.ArrayUtilities.lowerBound(e,r||1/0,((e,t)=>e-t.startTime));return e.slice(i,a)}});let Tt=1;const vt=new Map;let ht=[];var pt=Object.freeze({__proto__:null,reset:function(){vt.clear(),ht=[],Tt=1},initialize:function(){if(1!==Tt)throw new Error("GPU Handler was not reset before being initialized");Tt=2},handleEvent:function(n){if(2!==Tt)throw new Error("GPU Handler is not initialized");t.TraceEvents.isTraceEventGPUTask(n)&&e.Trace.addEventToProcessThread(n,vt)},finalize:async function(){if(2!==Tt)throw new Error("GPU Handler is not initialized");const{gpuProcessId:e,gpuThreadId:t}=fe(),n=vt.get(e);n&&t&&(ht=n.get(t)||[]),Tt=3},data:function(){if(3!==Tt)throw new Error("GPU Handler is not finalized");return{mainGPUThreadTasks:ht}},deps:function(){return["Meta"]}});const Et=new Map,wt=new Map,St=new Map,Mt=new Map;var It=Object.freeze({__proto__:null,reset:function(){Et.clear(),wt.clear(),St.clear(),Mt.clear()},handleEvent:function(e){if(t.TraceEvents.isTraceEventPaintImage(e)){const t=Et.get(e.pid)||new Map,n=t.get(e.tid)||[];return n.push(e),t.set(e.tid,n),void Et.set(e.pid,t)}if(t.TraceEvents.isTraceEventDecodeLazyPixelRef(e)&&void 0!==e.args?.LazyPixelRef){const t=wt.get(e.pid)||new Map,n=t.get(e.tid)||[];n.push(e),t.set(e.tid,n),wt.set(e.pid,t)}if(t.TraceEvents.isTraceEventDrawLazyPixelRef(e)&&void 0!==e.args?.LazyPixelRef){const t=Et.get(e.pid)?.get(e.tid)?.at(-1);if(!t)return;St.set(e.args.LazyPixelRef,t)}else if(t.TraceEvents.isTraceEventDecodeImage(e)){const t=Et.get(e.pid)?.get(e.tid)?.at(-1);if(t)return void Mt.set(e,t);const n=wt.get(e.pid)?.get(e.tid)?.at(-1);if(!n||void 0===n.args?.LazyPixelRef)return;const r=St.get(n.args.LazyPixelRef);if(!r)return;Mt.set(e,r)}},data:function(){return{paintImageByDrawLazyPixelRef:St,paintImageForEvent:Mt}}});let yt=1;const Ft=new Map,Pt=new Map,_t=new Map,Ct=[],Rt=new Map,Dt=new Map,kt=new Map,Lt=new Map,bt=new Map,Nt=new Map,zt=new Map;function xt(e){Dt.set(e.event,e.initiator);const t=kt.get(e.initiator)||[];t.push(e.event),kt.set(e.initiator,t)}var Wt=Object.freeze({__proto__:null,reset:function(){Ft.clear(),Pt.clear(),_t.clear(),bt.clear(),Dt.clear(),kt.clear(),Lt.clear(),Nt.clear(),zt.clear(),Rt.clear(),Ct.length=0,yt=1},initialize:function(){if(1!==yt)throw new Error("InitiatorsHandler was not reset before being initialized");yt=2},handleEvent:function(n){if(t.TraceEvents.isTraceEventScheduleStyleRecalculation(n))Ft.set(n.args.data.frame,n);else if(t.TraceEvents.isTraceEventUpdateLayoutTree(n)){if(n.args.beginData){_t.set(n.args.beginData.frame,n);const e=Ft.get(n.args.beginData.frame);e&&xt({event:n,initiator:e})}}else if(t.TraceEvents.isTraceEventInvalidateLayout(n)){let t=n;if(!Pt.has(n.args.data.frame)){const r=_t.get(n.args.data.frame);if(r){const{endTime:i}=e.Timing.eventTimingsMicroSeconds(r),a=Dt.get(r);a&&i&&i>n.ts&&(t=a)}}Pt.set(n.args.data.frame,t)}else if(t.TraceEvents.isTraceEventLayout(n)){const e=Pt.get(n.args.beginData.frame);e&&xt({event:n,initiator:e}),Pt.delete(n.args.beginData.frame)}else if(t.TraceEvents.isTraceEventRequestAnimationFrame(n))Lt.set(n.args.data.id,n);else if(t.TraceEvents.isTraceEventFireAnimationFrame(n)){const e=Lt.get(n.args.data.id);e&&xt({event:n,initiator:e})}else if(t.TraceEvents.isTraceEventTimerInstall(n))bt.set(n.args.data.timerId,n);else if(t.TraceEvents.isTraceEventTimerFire(n)){const e=bt.get(n.args.data.timerId);e&&xt({event:n,initiator:e})}else if(t.TraceEvents.isTraceEventRequestIdleCallback(n))Nt.set(n.args.data.id,n);else if(t.TraceEvents.isTraceEventFireIdleCallback(n)){const e=Nt.get(n.args.data.id);e&&xt({event:n,initiator:e})}else if(t.TraceEvents.isTraceEventWebSocketCreate(n))zt.set(n.args.data.identifier,n);else if(t.TraceEvents.isTraceEventWebSocketInfo(n)||t.TraceEvents.isTraceEventWebSocketTransfer(n)){const e=zt.get(n.args.data.identifier);e&&xt({event:n,initiator:e})}else if(t.TraceEvents.isTraceEventHandlePostMessage(n))Ct.push(n);else if(t.TraceEvents.isTraceEventSchedulePostMessage(n)){const e=n.args.data?.traceId;e&&Rt.set(e,n)}},finalize:async function(){if(2!==yt)throw new Error("InitiatorsHandler is not initialized");!function(){for(const e of Ct){const t=e.args.data?.traceId,n=Rt.get(t);n&&xt({event:e,initiator:n})}}(),yt=3},data:function(){return{eventToInitiator:Dt,initiatorToEvents:kt}}});let Ot=1;const Bt=new Map,Ut=new Map;let qt=null,Ht=!1;const At=[];let jt=null;function Gt(e,t){const n=Bt.get(e)||[];n.push(t),null!==jt&&n.length>jt&&n.shift(),Bt.set(e,n);const r=Ut.get(e)??0;Ut.set(e,r+1)}var Vt=Object.freeze({__proto__:null,reset:function(){Ot=1,Bt.clear(),qt=null,At.length=0,Ht=!1,jt=null},handleUserConfig:function(e){jt=e.maxInvalidationEventsPerEvent},initialize:function(){if(1!==Ot)throw new Error("InvalidationsHandler was not reset before being initialized");Ot=2},handleEvent:function(e){if(0!==jt)if(t.TraceEvents.isTraceEventUpdateLayoutTree(e)){qt=e;for(const n of At){if(t.TraceEvents.isTraceEventLayoutInvalidationTracking(n))continue;const r=qt.args.beginData?.frame;r&&n.args.data.frame===r&&Gt(e,n)}}else if(t.TraceEvents.isTraceEventInvalidationTracking(e)){if(Ht&&(At.length=0,qt=null,Ht=!1),qt&&(t.TraceEvents.isTraceEventScheduleStyleInvalidationTracking(e)||t.TraceEvents.isTraceEventStyleRecalcInvalidationTracking(e)||t.TraceEvents.isTraceEventStyleInvalidatorInvalidationTracking(e))){const t=qt.ts+(qt.dur||0);e.ts>=qt.ts&&e.ts<=t&&qt.args.beginData?.frame===e.args.data.frame&&Gt(qt,e)}At.push(e)}else if(t.TraceEvents.isTraceEventPaint(e))Ht=!0;else if(t.TraceEvents.isTraceEventLayout(e)){const n=e.args.beginData.frame;for(const r of At)t.TraceEvents.isTraceEventLayoutInvalidationTracking(r)&&r.args.data.frame===n&&Gt(e,r)}},finalize:async function(){if(2!==Ot)throw new Error("InvalidationsHandler is not initialized");Ot=3},data:function(){return{invalidationsForEvent:Bt,invalidationCountForEvent:Ut}}});const Xt=new Map;var $t=Object.freeze({__proto__:null,reset:function(){Xt.clear()},handleEvent:function(e){t.TraceEvents.isTraceEventLargestImagePaintCandidate(e)&&e.args.data&&Xt.set(e.args.data.DOMNodeId,e)},data:function(){return Xt}});const Yt=new Map;var Kt=Object.freeze({__proto__:null,reset:function(){Yt.clear()},handleEvent:function(e){t.TraceEvents.isTraceEventLargestTextPaintCandidate(e)&&e.args.data&&Yt.set(e.args.data.DOMNodeId,e)},data:function(){return Yt}});const Qt=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(5e3)),Jt=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(1e3)),Zt=[],en=[],tn=[],nn=[],rn=[],an=new Set,sn=[];let on=0,cn=-1;const dn=[],ln=[];let un=1;function mn(e){return{min:e,max:e,range:t.Timing.MicroSeconds(0)}}function fn(e,n){e.max=n,e.range=t.Timing.MicroSeconds(e.max-e.min)}var gn=Object.freeze({__proto__:null,MAX_CLUSTER_DURATION:Qt,MAX_SHIFT_TIME_DELTA:Jt,initialize:function(){if(1!==un)throw new Error("LayoutShifts Handler was not reset");un=2},reset:function(){un=1,Zt.length=0,en.length=0,tn.length=0,nn.length=0,sn.length=0,rn.length=0,an.clear(),dn.length=0,on=0,ln.length=0,cn=-1},handleEvent:function(e){if(2!==un)throw new Error("Handler is not initialized");!t.TraceEvents.isTraceEventLayoutShift(e)||e.args.data?.had_recent_input?t.TraceEvents.isTraceEventLayoutInvalidationTracking(e)?en.push(e):(t.TraceEvents.isTraceEventScheduleStyleInvalidationTracking(e)&&tn.push(e),t.TraceEvents.isTraceEventStyleRecalcInvalidationTracking(e)&&nn.push(e),t.TraceEvents.isTraceEventPrePaint(e)?sn.push(e):t.TraceEvents.isTraceEventRenderFrameImplCreateChildFrame(e)&&rn.push(e)):Zt.push(e)},finalize:async function(){Zt.sort(((e,t)=>e.ts-t.ts)),sn.sort(((e,t)=>e.ts-t.ts)),en.sort(((e,t)=>e.ts-t.ts)),rn.sort(((e,t)=>e.ts-t.ts)),await async function(){const{navigationsByFrameId:r,mainFrameId:i,traceBounds:a}=fe(),s=r.get(i)||[];if(0===Zt.length)return;let o=Zt[0].ts,c=Zt[0].ts,d=null;for(const r of Zt){const i=r.ts-o>Qt,a=r.ts-c>Jt,l=n.ArrayUtilities.nearestIndexFromEnd(s,(e=>e.ts<r.ts)),u=d!==l&&null!==l;if(i||a||u||!dn.length){const e=r.ts,n=i?o+Qt:1/0,d=a?c+Jt:1/0,m=u?s[l].ts:1/0,f=Math.min(n,d,m);if(dn.length>0){fn(dn[dn.length-1].clusterWindow,t.Timing.MicroSeconds(f))}const g=null===l?void 0:s[l].args.data?.navigationId;dn.push({events:[],clusterWindow:mn(e),clusterCumulativeScore:0,scoreWindows:{good:mn(e),needsImprovement:null,bad:null},navigationId:g,worstShiftEvent:null}),o=e}const m=dn[dn.length-1],f=null!==l?t.Timing.MicroSeconds(r.ts-s[l].ts):void 0;if(m.clusterCumulativeScore+=r.args.data?r.args.data.weighted_score_delta:0,!r.args.data)continue;const g=e.SyntheticEvents.SyntheticEventsManager.registerSyntheticBasedEvent({rawSourceEvent:r,...r,args:{frame:r.args.frame,data:{...r.args.data,rawEvent:r}},parsedData:{timeFromNavigation:f,cumulativeWeightedScoreInWindow:m.clusterCumulativeScore,sessionWindowData:{cumulativeWindowScore:0,id:dn.length}}});m.events.push(g),fn(m.clusterWindow,r.ts),c=r.ts,d=l}for(const e of dn){let r=0,i=-1;if(e===dn[dn.length-1]){const r=Qt+e.clusterWindow.min,i=e.clusterWindow.max+Jt,o=n.ArrayUtilities.nearestIndexFromBeginning(s,(t=>t.ts>e.clusterWindow.max)),c=o?s[o].ts:1/0,d=Math.min(r,i,a.max,c);fn(e.clusterWindow,t.Timing.MicroSeconds(d))}let o=0,c=null;for(const n of e.events){r+=n.args.data?n.args.data.weighted_score_delta:0,i=n.parsedData.sessionWindowData.id;const a=n.ts;n.parsedData.sessionWindowData.cumulativeWindowScore=e.clusterCumulativeScore,r<.1?fn(e.scoreWindows.good,a):r>=.1&&r<.25?(e.scoreWindows.needsImprovement||(fn(e.scoreWindows.good,t.Timing.MicroSeconds(a-1)),e.scoreWindows.needsImprovement=mn(a)),fn(e.scoreWindows.needsImprovement,a)):r>=.25&&(e.scoreWindows.bad||(e.scoreWindows.needsImprovement?fn(e.scoreWindows.needsImprovement,t.Timing.MicroSeconds(a-1)):fn(e.scoreWindows.good,t.Timing.MicroSeconds(a-1)),e.scoreWindows.bad=mn(n.ts)),fn(e.scoreWindows.bad,a)),e.scoreWindows.bad?fn(e.scoreWindows.bad,e.clusterWindow.max):e.scoreWindows.needsImprovement?fn(e.scoreWindows.needsImprovement,e.clusterWindow.max):fn(e.scoreWindows.good,e.clusterWindow.max);const s=n.args.data?.cumulative_score;void 0!==s&&s>o&&(o=s,c=n)}e.worstShiftEvent=c,r>on&&(cn=i,on=r)}}(),function(){const{traceBounds:e}=fe();ln.push({ts:e.min,score:0});for(const e of dn){let t=0;e.events[0].args.data&&ln.push({ts:e.clusterWindow.min,score:e.events[0].args.data.weighted_score_delta});for(let n=0;n<e.events.length;n++){const r=e.events[n];r.args.data&&(t+=r.args.data.weighted_score_delta,ln.push({ts:r.ts,score:t}))}ln.push({ts:e.clusterWindow.max,score:0})}}(),function(){an.clear();for(const e of Zt)if(e.args.data?.impacted_nodes)for(const t of e.args.data.impacted_nodes)an.add(t.node_id);for(const e of en)e.args.data?.nodeId&&an.add(e.args.data.nodeId);for(const e of tn)e.args.data?.nodeId&&an.add(e.args.data.nodeId)}(),un=3},data:function(){if(3!==un)throw new Error("Layout Shifts Handler is not finalized");return{clusters:dn,sessionMaxScore:on,clsWindowID:cn,prePaintEvents:sn,layoutInvalidationEvents:en,scheduleStyleInvalidationEvents:tn,styleRecalcInvalidationEvents:[],renderFrameImplCreateChildFrameEvents:rn,scoreRecords:ln,backendNodeIds:[...an]}},deps:function(){return["Screenshots","Meta"]},scoreClassificationForLayoutShift:function(e){let t="good";return e>=.1&&(t="ok"),e>=.25&&(t="bad"),t}});const Tn=new Map;var vn=Object.freeze({__proto__:null,reset:function(){Tn.clear()},handleEvent:function(e){if(t.TraceEvents.isTraceEventUpdateCounters(e)){const t=n.MapUtilities.getWithDefault(Tn,e.pid,(()=>[]));t.push(e),Tn.set(e.pid,t)}},data:function(){return{updateCountersByProcess:Tn}}});const hn=1e3,pn=1e6,En=new Map,wn=new Map,Sn=new Map,Mn=[],In=new Map,yn=new Map;function Fn(e,t,n){wn.has(e)||wn.set(e,{});const r=wn.get(e);if(!r)throw new Error(`Unable to locate trace events for request ID ${e}`);if(Array.isArray(r[t])){const e=n;r[t].push(...e)}else r[t]=n}function Pn(e){for(const t of e)if(t>0)return t;return 0}let _n=1;function Cn(){if(3!==_n)throw new Error("Network Request handler is not finalized");return{byOrigin:Sn,byTime:Mn,eventToInitiator:yn,webSocket:[...En.values()]}}var Rn=Object.freeze({__proto__:null,reset:function(){Sn.clear(),wn.clear(),Mn.length=0,In.clear(),yn.clear(),En.clear(),_n=1},initialize:function(){_n=2},handleEvent:function(e){if(2!==_n)throw new Error("Network Request handler is not initialized");if(t.TraceEvents.isTraceEventResourceChangePriority(e))Fn(e.args.data.requestId,"changePriority",e);else if(t.TraceEvents.isTraceEventResourceWillSendRequest(e))Fn(e.args.data.requestId,"willSendRequests",[e]);else if(t.TraceEvents.isTraceEventResourceSendRequest(e))Fn(e.args.data.requestId,"sendRequests",[e]);else if(t.TraceEvents.isTraceEventResourceReceiveResponse(e))Fn(e.args.data.requestId,"receiveResponse",e);else if(t.TraceEvents.isTraceEventResourceReceivedData(e))Fn(e.args.data.requestId,"receivedData",[e]);else if(t.TraceEvents.isTraceEventResourceFinish(e))Fn(e.args.data.requestId,"resourceFinish",e);else if(t.TraceEvents.isTraceEventResourceMarkAsCached(e))Fn(e.args.data.requestId,"resourceMarkAsCached",e);else if(t.TraceEvents.isTraceEventWebSocketCreate(e)||t.TraceEvents.isTraceEventWebSocketInfo(e)||t.TraceEvents.isTraceEventWebSocketTransfer(e)){const t=e.args.data.identifier;En.has(t)||(e.args.data.frame?En.set(t,{frame:e.args.data.frame,webSocketIdentifier:t,events:[],syntheticConnectionEvent:null}):e.args.data.workerId&&En.set(t,{workerId:e.args.data.workerId,webSocketIdentifier:t,events:[],syntheticConnectionEvent:null})),En.get(t)?.events.push(e)}},finalize:async function(){if(2!==_n)throw new Error("Network Request handler is not initialized");const{rendererProcessesByFrame:r}=fe();for(const[i,a]of wn.entries()){if(!a.sendRequests||!a.receiveResponse)continue;const s=[];for(let e=0;e<a.sendRequests.length-1;e++){const n=a.sendRequests[e],r=a.sendRequests[e+1];let i=n.ts,o=t.Timing.MicroSeconds(r.ts-n.ts);if(a.willSendRequests&&a.willSendRequests[e]&&a.willSendRequests[e+1]){const n=a.willSendRequests[e],r=a.willSendRequests[e+1];i=n.ts,o=t.Timing.MicroSeconds(r.ts-n.ts)}s.push({url:n.args.data.url,priority:n.args.data.priority,requestMethod:n.args.data.requestMethod,ts:i,dur:o})}const o=0!==a.resourceFinish?.args.data.encodedDataLength,c=a.receiveResponse.args.data.fromCache&&!a.receiveResponse.args.data.fromServiceWorker&&!o,d=void 0!==a.resourceMarkAsCached,l=d||c,u=a.receiveResponse.args.data.timing;if(!u&&!l)continue;const m=a.sendRequests[0],f=a.sendRequests[a.sendRequests.length-1],g=f.args.data.priority;let T=g;a.changePriority&&(T=a.changePriority.args.data.priority);const v=a.willSendRequests&&a.willSendRequests.length?t.Timing.MicroSeconds(a.willSendRequests[0].ts):t.Timing.MicroSeconds(m.ts),h=a.willSendRequests&&a.willSendRequests.length?t.Timing.MicroSeconds(a.willSendRequests[a.willSendRequests.length-1].ts):t.Timing.MicroSeconds(f.ts),p=a.resourceFinish?a.resourceFinish.ts:h,E=a.resourceFinish?.args.data.finishTime?t.Timing.MicroSeconds(a.resourceFinish.args.data.finishTime*pn):t.Timing.MicroSeconds(p),w=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((E||h)-h),S=t.Timing.MicroSeconds(p-(E||p)),M=t.Timing.MicroSeconds(h-v),I=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds(n.NumberUtilities.clamp(u.requestTime*pn-h,0,Number.MAX_VALUE)),y=l?t.Timing.MicroSeconds(a.receiveResponse.ts-v):t.Timing.MicroSeconds(Pn([u.dnsStart*hn,u.connectStart*hn,u.sendStart*hn,a.receiveResponse.ts-h])),F=l?v:t.Timing.MicroSeconds(u.requestTime*pn+u.sendStart*hn),P=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((u.receiveHeadersEnd-u.sendEnd)*hn),_=l?v:t.Timing.MicroSeconds(u.requestTime*pn+u.receiveHeadersEnd*hn),C=l?t.Timing.MicroSeconds(p-a.receiveResponse.ts):t.Timing.MicroSeconds((E||_)-_),R=t.Timing.MicroSeconds(w+S),D=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((u.dnsEnd-u.dnsStart)*hn),k=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((u.sslEnd-u.sslStart)*hn),L=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((u.proxyEnd-u.proxyStart)*hn),b=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((u.sendEnd-u.sendStart)*hn),N=l?t.Timing.MicroSeconds(0):t.Timing.MicroSeconds((u.connectEnd-u.connectStart)*hn),{frame:z,url:x,renderBlocking:W}=f.args.data,{encodedDataLength:O,decodedBodyLength:B}=a.resourceFinish?a.resourceFinish.args.data:{encodedDataLength:0,decodedBodyLength:0},U=new URL(x),q="https:"===U.protocol,H=e.Trace.activeURLForFrameAtTime(z,f.ts,r)||"",A=e.SyntheticEvents.SyntheticEventsManager.registerSyntheticBasedEvent({rawSourceEvent:f,args:{data:{syntheticData:{dnsLookup:D,download:C,downloadStart:_,finishTime:E,initialConnection:N,isDiskCached:c,isHttps:q,isMemoryCached:d,isPushedResource:o,networkDuration:w,processingDuration:S,proxyNegotiation:L,queueing:I,redirectionDuration:M,requestSent:b,sendStartTime:F,ssl:k,stalled:y,totalTime:R,waiting:P},decodedBodyLength:B,encodedDataLength:O,frame:z,fromServiceWorker:a.receiveResponse.args.data.fromServiceWorker,isLinkPreload:f.args.data.isLinkPreload||!1,mimeType:a.receiveResponse.args.data.mimeType,priority:T,initialPriority:g,protocol:a.receiveResponse.args.data.protocol??"unknown",redirects:s,renderBlocking:W??"non_blocking",requestId:i,requestingFrameUrl:H,requestMethod:f.args.data.requestMethod,resourceType:f.args.data.resourceType,statusCode:a.receiveResponse.args.data.statusCode,responseHeaders:a.receiveResponse.args.data.headers||[],fetchPriorityHint:f.args.data.fetchPriorityHint,initiator:f.args.data.initiator,stackTrace:f.args.data.stackTrace,timing:u,url:x,failed:a.resourceFinish?.args.data.didFail??!1,finished:Boolean(a.resourceFinish),connectionId:a.receiveResponse.args.data.connectionId,connectionReused:a.receiveResponse.args.data.connectionReused}},cat:"loading",name:"SyntheticNetworkRequest",ph:"X",dur:t.Timing.MicroSeconds(p-v),tdur:t.Timing.MicroSeconds(p-v),ts:t.Timing.MicroSeconds(v),tts:t.Timing.MicroSeconds(v),pid:f.pid,tid:f.tid}),j=n.MapUtilities.getWithDefault(Sn,U.host,(()=>({renderBlocking:[],nonRenderBlocking:[],all:[]})));e.Network.isSyntheticNetworkRequestEventRenderBlocking(A)?j.renderBlocking.push(A):j.nonRenderBlocking.push(A),j.all.push(A),Mn.push(A);const G=A.args.data.initiator?.url||e.Trace.getZeroIndexedStackTraceForEvent(A)?.at(0)?.url;if(G){const e=In.get(G)??[];e.push(A),In.set(G,e)}}for(const e of Mn){const t=In.get(e.args.data.url);if(t)for(const n of t)yn.set(n,e)}En.forEach((e=>{let n=null,r=null;for(const i of e.events)t.TraceEvents.isTraceEventWebSocketCreate(i)&&(n=i),t.TraceEvents.isTraceEventWebSocketDestroy(i)&&(r=i);e.syntheticConnectionEvent=function(e,t,n){const{traceBounds:r}=fe(),i=e?e.ts:r.min,a=t?t.ts:r.max,s=a-i,o=e||t||n;return{name:"SyntheticWebSocketConnectionEvent",cat:o.cat,ph:"X",ts:i,dur:s,pid:o.pid,tid:o.tid,s:o.s,rawSourceEvent:o,_tag:"SyntheticEntryTag",args:{data:{identifier:o.args.data.identifier,priority:"Low",url:o.args.data.url||""}}}}(n,r,e.events[0])})),_n=3},data:Cn,deps:function(){return["Meta"]}});const Dn=new Map;var kn=Object.freeze({__proto__:null,reset:function(){Dn.clear()},handleEvent:function(e){if(t.TraceEvents.isTraceEventTracingStartedInBrowser(e))for(const t of e.args.data?.frames??[])Dn.set(t.frame,t);else if(t.TraceEvents.isTraceEventCommitLoad(e)){const t=e.args.data;if(!t)return;const n=Dn.get(t.frame);if(!n)return;Dn.set(t.frame,{...n,url:t.url||n.url,name:t.name||t.name})}},data:function(){return{frames:Dn}}});const Ln=new Map;let bn=[];let Nn=[];const zn=new Set;function xn(r,i){const a=r.args.data?.navigationId;if(!a)throw new Error("Navigation event unexpectedly had no navigation ID.");const s=On(i),{rendererProcessesByFrame:o}=fe(),c=o.get(s);if(!c)return;if(c.get(i.pid)&&!t.TraceEvents.isTraceEventNavigationStart(i))if(t.TraceEvents.isTraceEventFirstContentfulPaint(i)){const e=t.Timing.MicroSeconds(i.ts-r.ts);Wn(s,a,{event:i,metricName:"FCP",classification:Un(e),navigation:r,timing:e})}else if(t.TraceEvents.isTraceEventFirstPaint(i)){Wn(s,a,{event:i,metricName:"FP",classification:"unclassified",navigation:r,timing:t.Timing.MicroSeconds(i.ts-r.ts)})}else if(t.TraceEvents.isTraceEventMarkDOMContent(i)){const e=t.Timing.MicroSeconds(i.ts-r.ts);Wn(s,a,{event:i,metricName:"DCL",classification:"unclassified",navigation:r,timing:e})}else if(t.TraceEvents.isTraceEventInteractiveTime(i)){const n=t.Timing.MicroSeconds(i.ts-r.ts);Wn(s,a,{event:i,metricName:"TTI",classification:qn(n),navigation:r,timing:n});const o=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(i.args.args.total_blocking_time_ms));Wn(s,a,{event:i,metricName:"TBT",classification:jn(o),navigation:r,timing:o})}else if(t.TraceEvents.isTraceEventMarkLoad(i)){Wn(s,a,{event:i,metricName:"L",classification:"unclassified",navigation:r,timing:t.Timing.MicroSeconds(i.ts-r.ts)})}else if(t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(i)){const e=i.args.data?.candidateIndex;if(!e)throw new Error("Largest Contenful Paint unexpectedly had no candidateIndex.");const o=t.Timing.MicroSeconds(i.ts-r.ts),c={event:i,metricName:"LCP",classification:Hn(o),navigation:r,timing:o},d=n.MapUtilities.getWithDefault(Ln,s,(()=>new Map)),l=n.MapUtilities.getWithDefault(d,a,(()=>new Map)).get("LCP");if(void 0===l)return zn.add(c.event),void Wn(s,a,c);const u=l.event;if(!t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(u))return;const m=u.args.data?.candidateIndex;if(!m)return;m<e&&(zn.delete(u),zn.add(c.event),Wn(s,a,c))}else if(!t.TraceEvents.isTraceEventLayoutShift(i))return n.assertNever(i,`Unexpected event type: ${i}`)}function Wn(e,t,r){const i=n.MapUtilities.getWithDefault(Ln,e,(()=>new Map)),a=n.MapUtilities.getWithDefault(i,t,(()=>new Map));a.delete(r.metricName),a.set(r.metricName,r)}function On(e){if(t.TraceEvents.isTraceEventFirstContentfulPaint(e)||t.TraceEvents.isTraceEventInteractiveTime(e)||t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(e)||t.TraceEvents.isTraceEventNavigationStart(e)||t.TraceEvents.isTraceEventLayoutShift(e)||t.TraceEvents.isTraceEventFirstPaint(e))return e.args.frame;if(t.TraceEvents.isTraceEventMarkDOMContent(e)||t.TraceEvents.isTraceEventMarkLoad(e)){const t=e.args.data?.frame;if(!t)throw new Error("MarkDOMContent unexpectedly had no frame ID.");return t}n.assertNever(e,`Unexpected event type: ${e}`)}function Bn(r){if(t.TraceEvents.isTraceEventFirstContentfulPaint(r)||t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(r)||t.TraceEvents.isTraceEventFirstPaint(r)){const e=r.args.data?.navigationId;if(!e)throw new Error("Trace event unexpectedly had no navigation ID.");const{navigationsByNavigationId:t}=fe(),n=t.get(e);return n||null}if(t.TraceEvents.isTraceEventMarkDOMContent(r)||t.TraceEvents.isTraceEventInteractiveTime(r)||t.TraceEvents.isTraceEventLayoutShift(r)||t.TraceEvents.isTraceEventMarkLoad(r)){const t=On(r),{navigationsByFrameId:n}=fe();return e.Trace.getNavigationForTraceEvent(r,t,n)}return t.TraceEvents.isTraceEventNavigationStart(r)?null:n.assertNever(r,`Unexpected event type: ${r}`)}function Un(n){const r=e.Timing.secondsToMicroseconds(t.Timing.Seconds(1.8));let i="bad";return n<=e.Timing.secondsToMicroseconds(t.Timing.Seconds(3))&&(i="ok"),n<=r&&(i="good"),i}function qn(n){const r=e.Timing.secondsToMicroseconds(t.Timing.Seconds(3.8));let i="bad";return n<=e.Timing.secondsToMicroseconds(t.Timing.Seconds(7.3))&&(i="ok"),n<=r&&(i="good"),i}function Hn(n){const r=e.Timing.secondsToMicroseconds(t.Timing.Seconds(2.5));let i="bad";return n<=e.Timing.secondsToMicroseconds(t.Timing.Seconds(4))&&(i="ok"),n<=r&&(i="good"),i}function An(e){return"unclassified"}function jn(n){const r=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(200));let i="bad";return n<=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(600))&&(i="ok"),n<=r&&(i="good"),i}var Gn=Object.freeze({__proto__:null,reset:function(){Ln.clear(),Nn=[],bn=[],zn.clear()},handleEvent:function(e){t.TraceEvents.eventIsPageLoadEvent(e)&&Nn.push(e)},getFrameIdForPageLoadEvent:On,scoreClassificationForFirstContentfulPaint:Un,scoreClassificationForTimeToInteractive:qn,scoreClassificationForLargestContentfulPaint:Hn,scoreClassificationForDOMContentLoaded:An,scoreClassificationForTotalBlockingTime:jn,finalize:async function(){Nn.sort(((e,t)=>e.ts-t.ts));for(const e of Nn){const t=Bn(e);t&&xn(t,e)}const e=function(){const e=[],t=[...Ln.values()].flatMap((e=>[...e.values()]));for(let n=0;n<t.length;n++){const r=t[n].get("LCP");r&&r.event&&e.push(r.event)}return e}(),n=fe().mainFrameId,r=[...e,...Nn.filter((e=>!t.TraceEvents.isTraceEventLargestContentfulPaintCandidate(e)))].filter(t.TraceEvents.isTraceEventMarkerEvent);bn=r.filter((e=>On(e)===n)).sort(((e,t)=>e.ts-t.ts))},data:function(){return{metricScoresByFrameId:Ln,allMarkerEvents:bn}},deps:function(){return["Meta"]}});const Vn=[],Xn=[],$n=[];let Yn={};function Kn(e){const t=parseInt(e.id,16);if(1===t)return e.ts;return Yn[t]??e.ts}var Qn=Object.freeze({__proto__:null,reset:function(){Vn.length=0,Xn.length=0,$n.length=0,Yn={}},handleEvent:function(e){t.TraceEvents.isTraceEventScreenshot(e)?Xn.push(e):t.TraceEvents.isTraceEventPipelineReporter(e)&&Vn.push(e)},finalize:async function(){const n=e.Trace.createMatchedSortedSyntheticEvents(Vn);Yn=Object.fromEntries(n.map((e=>[e.args.data.beginEvent.args.chrome_frame_reporter.frame_sequence,t.Timing.MicroSeconds(e.ts+e.dur)])));for(const t of Xn){const{cat:n,name:r,ph:i,pid:a,tid:s}=t,o=e.SyntheticEvents.SyntheticEventsManager.registerSyntheticBasedEvent({rawSourceEvent:t,cat:n,name:r,ph:i,pid:a,tid:s,ts:Kn(t),args:{dataUri:`data:image/jpg;base64,${t.args.snapshot}`}});$n.push(o)}},data:function(){return $n},deps:function(){return["Meta"]}});let Jn=null;const Zn=new Map;var er=Object.freeze({__proto__:null,reset:function(){Jn=null,Zn.clear()},handleEvent:function(e){t.TraceEvents.isTraceEventSelectorStats(e)&&Jn&&e.args.selector_stats?Zn.set(Jn,{timings:e.args.selector_stats.selector_timings}):t.TraceEvents.isTraceEventUpdateLayoutTree(e)&&(Jn=e)},data:function(){return{dataForUpdateLayoutEvent:Zn}}});const tr=[];let nr=1;const rr="response-start",ir="response-end";function ar(n,r,i,a){const s=n.args.data.syntheticData.sendStartTime,o=n.args.data.syntheticData.sendStartTime+n.args.data.syntheticData.waiting,c=t.Timing.MicroSeconds((r-s+i-o)/2),d=[];for(const r of a){if(r.metric===rr||r.metric===ir)continue;if(null===r.start)continue;const i=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(r.start))-c,a=new URL(n.args.data.url).origin,s=e.SyntheticEvents.SyntheticEventsManager.registerServerTiming({rawSourceEvent:n.rawSourceEvent,name:r.metric,ph:"X",pid:t.TraceEvents.ProcessID(0),tid:t.TraceEvents.ThreadID(0),ts:t.Timing.MicroSeconds(i),dur:e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(r.value)),cat:"devtools.server-timing",args:{data:{desc:r.description||void 0,origin:a}}});n.args.data.syntheticServerTimings||(n.args.data.syntheticServerTimings=[]),n.args.data.syntheticServerTimings.push(s),d.push(s)}return d}var sr=Object.freeze({__proto__:null,reset:function(){tr.length=0,nr=1},initialize:function(){nr=2},handleEvent:function(e){},finalize:async function(){if(2!==nr)throw new Error("Server Timings handler is not initialized");!function(){for(const e of Cn().byTime){let t=null;for(const r of e.args.data.responseHeaders){const e=r.name.toLocaleLowerCase();"server-timing"!==e&&"server-timing-test"!==e||(r.name="server-timing",t=n.ServerTiming.ServerTiming.parseHeaders([r]))}const r=t?.find((e=>e.metric===rr))?.start,i=t?.find((e=>e.metric===ir))?.start;if(!r||!i||!t)continue;const a=1e3*r,s=1e3*i;tr.push(...ar(e,a,s,t))}}(),e.Trace.sortTraceEventsInPlace(tr),nr=3},data:function(){if(3!==nr)throw new Error("Server Timing handler is not finalized");return{serverTimings:tr}},deps:function(){return["NetworkRequests"]}});const or=[],cr=[],dr=[],lr=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(200)),ur=lr,mr=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(500));let fr=null;const gr=[],Tr=[],vr=new Map,hr=[];let pr=1;const Er=new Set(["pointerdown","touchstart","pointerup","touchend","mousedown","mouseup","click"]),wr=new Set(["keydown","keypress","keyup"]);function Sr(e){return Er.has(e.type)?"POINTER":wr.has(e.type)?"KEYBOARD":"OTHER"}function Mr(e){const n={POINTER:new Map,KEYBOARD:new Map,OTHER:new Map};function r(e){const r=Sr(e),i=n[r],a=t.Timing.MicroSeconds(e.ts+e.dur),s=i.get(a);if(s){if(e.ts<s.ts)i.set(a,e);else if(e.ts===s.ts&&e.interactionId===s.interactionId){const t=s.processingEnd-s.processingStart;e.processingEnd-e.processingStart>t&&i.set(a,e)}e.processingStart<s.processingStart&&(s.processingStart=e.processingStart,Ir(s)),e.processingEnd>s.processingEnd&&(s.processingEnd=e.processingEnd,Ir(s))}else i.set(a,e)}for(const t of e)r(t);const i=Object.values(n).flatMap((e=>Array.from(e.values())));return i.sort(((e,t)=>e.ts-t.ts)),i}function Ir(e){const n=e.args.data.beginEvent,r=e.args.data.endEvent;e.inputDelay=t.Timing.MicroSeconds(e.processingStart-n.ts),e.mainThreadHandling=t.Timing.MicroSeconds(e.processingEnd-e.processingStart),e.presentationDelay=t.Timing.MicroSeconds(r.ts-e.processingEnd)}function yr(){return{allEvents:or,beginCommitCompositorFrameEvents:cr,parseMetaViewportEvents:dr,interactionEvents:gr,interactionEventsWithNoNesting:Tr,longestInteractionEvent:fr,interactionsOverThreshold:new Set(gr.filter((e=>e.dur>lr)))}}var Fr=Object.freeze({__proto__:null,LONG_INTERACTION_THRESHOLD:lr,reset:function(){or.length=0,cr.length=0,dr.length=0,gr.length=0,hr.length=0,vr.clear(),Tr.length=0,fr=null,pr=2},handleEvent:function(e){if(2!==pr)throw new Error("Handler is not initialized");if(t.TraceEvents.isTraceEventBeginCommitCompositorFrame(e))return void cr.push(e);if(t.TraceEvents.isTraceEventParseMetaViewport(e))return void dr.push(e);if(!t.TraceEvents.isTraceEventEventTiming(e))return;if(t.TraceEvents.isTraceEventEventTimingEnd(e)&&vr.set(e.id,e),or.push(e),!e.args.data||!t.TraceEvents.isTraceEventEventTimingStart(e))return;const{duration:n,interactionId:r}=e.args.data;n<1||void 0===r||0===r||hr.push(e)},categoryOfInteraction:Sr,removeNestedInteractions:Mr,finalize:async function(){const{navigationsByFrameId:n}=fe();for(const r of hr){const i=vr.get(r.id);if(!i)continue;if(!r.args.data?.type||!r.args.data?.interactionId)continue;const a=t.Timing.MicroSeconds(e.Timing.millisecondsToMicroseconds(r.args.data.processingStart)-e.Timing.millisecondsToMicroseconds(r.args.data.timeStamp)+r.ts),s=t.Timing.MicroSeconds(e.Timing.millisecondsToMicroseconds(r.args.data.processingEnd)-e.Timing.millisecondsToMicroseconds(r.args.data.timeStamp)+r.ts),o=r.args.frame??r.args.data.frame,c=e.Trace.getNavigationForTraceEvent(r,o,n),d=c?.args.data?.navigationId,l=e.SyntheticEvents.SyntheticEventsManager.registerSyntheticBasedEvent({rawSourceEvent:r,cat:r.cat,name:r.name,pid:r.pid,tid:r.tid,ph:r.ph,processingStart:a,processingEnd:s,inputDelay:t.Timing.MicroSeconds(-1),mainThreadHandling:t.Timing.MicroSeconds(-1),presentationDelay:t.Timing.MicroSeconds(-1),args:{data:{beginEvent:r,endEvent:i,frame:o,navigationId:d}},ts:r.ts,dur:t.Timing.MicroSeconds(i.ts-r.ts),type:r.args.data.type,interactionId:r.args.data.interactionId});Ir(l),gr.push(l)}pr=3,Tr.push(...Mr(gr));for(const e of Tr)(!fr||fr.dur<e.dur)&&(fr=e)},data:yr,deps:function(){return["Meta"]},scoreClassificationForInteractionToNextPaint:function(e){return e<=ur?"good":e<=mr?"ok":"bad"}});const Pr=new Map,_r=new Map,Cr=[],Rr=[],Dr=[],kr=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(30)),Lr=e.Timing.millisecondsToMicroseconds(t.Timing.MilliSeconds(50));function br(e,t){const r=n.MapUtilities.getWithDefault(Pr,e,(()=>[]));r.push(t),Pr.set(e,r);const i=n.MapUtilities.getWithDefault(_r,t,(()=>[]));i.push(e),_r.set(t,i)}function Nr(e,t,n=!0){let r=t.at(-1);for(;r&&e.ts>r.ts+(r.dur||0);)t.pop(),r=t.at(-1);n&&t.push(e)}var zr=Object.freeze({__proto__:null,FORCED_REFLOW_THRESHOLD:kr,LONG_MAIN_THREAD_TASK_THRESHOLD:Lr,reset:function(){Pr.clear(),_r.clear(),Cr.length=0,Rr.length=0,Dr.length=0},handleEvent:function(n){if(function(e){if(Nr(e,Cr),Nr(e,Rr,t.TraceEvents.isJSInvocationEvent(e)),Rr.length&&("Layout"===e.name||"UpdateLayoutTree"===e.name))return void Dr.push(e);if(1===Cr.length){const e=Dr.reduce(((e,t)=>e+(t.dur||0)),0);e>=kr&&Dr.forEach((e=>br(e,"FORCED_REFLOW"))),Dr.length=0}}(n),"RunTask"!==n.name)if(t.TraceEvents.isTraceEventFireIdleCallback(n)){const{duration:t}=e.Timing.eventTimingsMilliSeconds(n);t>n.args.data.allottedMilliseconds&&br(n,"IDLE_CALLBACK_OVER_TIME")}else;else{const{duration:t}=e.Timing.eventTimingsMicroSeconds(n);t>Lr&&br(n,"LONG_TASK")}},deps:function(){return["UserInteractions"]},finalize:async function(){const e=yr().interactionsOverThreshold;for(const t of e)br(t,"LONG_INTERACTION")},data:function(){return{perEvent:Pr,perWarning:_r}}});let xr=1;const Wr=[],Or=new Map,Br=new Map;var Ur=Object.freeze({__proto__:null,initialize:function(){if(1!==xr)throw new Error("Workers Handler was not reset");xr=2},reset:function(){Wr.length=0,Or.clear(),Br.clear(),xr=1},handleEvent:function(e){if(2!==xr)throw new Error("Workers Handler is not initialized");t.TraceEvents.isTraceEventTracingSessionIdForWorker(e)&&Wr.push(e)},finalize:async function(){if(2!==xr)throw new Error("Handler is not initialized");for(const e of Wr)e.args.data&&(Or.set(e.args.data.workerThreadId,e.args.data.workerId),Br.set(e.args.data.workerId,e.args.data.url));xr=3},data:function(){if(3!==xr)throw new Error("Workers Handler is not finalized");return{workerSessionIdEvents:Wr,workerIdByThread:Or,workerURLById:Br}}}),qr=Object.freeze({__proto__:null,Animations:o,AuctionWorklets:v,EnhancedTraces:_,ExtensionTraceData:j,Frames:gt,GPU:pt,ImagePainting:It,Initiators:Wt,Invalidations:Vt,LargestImagePaint:$t,LargestTextPaint:Kt,LayerTree:ye,LayoutShifts:gn,Memory:vn,Meta:ge,NetworkRequests:Rn,PageFrames:kn,PageLoadMetrics:Gn,Renderer:et,Samples:Le,Screenshots:Qn,SelectorStats:er,ServerTimings:sr,UserInteractions:Fr,UserTimings:x,Warnings:zr,Workers:Ur}),Hr=Object.freeze({__proto__:null});export{qr as ModelHandlers,rt as Threads,Hr as Types};
